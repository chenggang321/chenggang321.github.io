<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>网站的缓存控制策略最佳实践及注意事项 | 博客</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <meta name="description" content="一个值得收藏的博客，涵盖了前端、后端、运维等关键技术。">
    
    <link rel="preload" href="/assets/css/0.styles.decdc3e0.css" as="style"><link rel="preload" href="/assets/js/app.4f4ef6e8.js" as="script"><link rel="preload" href="/assets/js/2.b1de68ec.js" as="script"><link rel="preload" href="/assets/js/8.ae557884.js" as="script"><link rel="prefetch" href="/assets/js/10.ab3f99ad.js"><link rel="prefetch" href="/assets/js/100.c81995d2.js"><link rel="prefetch" href="/assets/js/101.d6704593.js"><link rel="prefetch" href="/assets/js/102.a7a3e5a5.js"><link rel="prefetch" href="/assets/js/103.50f9015f.js"><link rel="prefetch" href="/assets/js/104.e2bee3c6.js"><link rel="prefetch" href="/assets/js/105.2ee035f2.js"><link rel="prefetch" href="/assets/js/106.3078fc48.js"><link rel="prefetch" href="/assets/js/107.e6576c7d.js"><link rel="prefetch" href="/assets/js/108.6e586c28.js"><link rel="prefetch" href="/assets/js/109.ecde7cf8.js"><link rel="prefetch" href="/assets/js/11.c48f519a.js"><link rel="prefetch" href="/assets/js/110.6641473f.js"><link rel="prefetch" href="/assets/js/111.8f2a5a0b.js"><link rel="prefetch" href="/assets/js/112.83d88710.js"><link rel="prefetch" href="/assets/js/113.bd8649a4.js"><link rel="prefetch" href="/assets/js/114.d80d74ff.js"><link rel="prefetch" href="/assets/js/115.e104d185.js"><link rel="prefetch" href="/assets/js/116.01177820.js"><link rel="prefetch" href="/assets/js/117.c97cce82.js"><link rel="prefetch" href="/assets/js/118.57091e41.js"><link rel="prefetch" href="/assets/js/119.fbc29d3d.js"><link rel="prefetch" href="/assets/js/12.4af41c18.js"><link rel="prefetch" href="/assets/js/120.9c94d5b1.js"><link rel="prefetch" href="/assets/js/121.a45c247c.js"><link rel="prefetch" href="/assets/js/122.18142e32.js"><link rel="prefetch" href="/assets/js/123.5111d68f.js"><link rel="prefetch" href="/assets/js/124.bab3e582.js"><link rel="prefetch" href="/assets/js/125.30969020.js"><link rel="prefetch" href="/assets/js/126.5fea7783.js"><link rel="prefetch" href="/assets/js/127.e8670bd7.js"><link rel="prefetch" href="/assets/js/128.635880cb.js"><link rel="prefetch" href="/assets/js/129.709853ca.js"><link rel="prefetch" href="/assets/js/13.3383eeb2.js"><link rel="prefetch" href="/assets/js/130.cb9c6e3d.js"><link rel="prefetch" href="/assets/js/131.47d3ded4.js"><link rel="prefetch" href="/assets/js/132.ac39324d.js"><link rel="prefetch" href="/assets/js/133.40c44fdc.js"><link rel="prefetch" href="/assets/js/134.2c87bf61.js"><link rel="prefetch" href="/assets/js/135.cd1ebec4.js"><link rel="prefetch" href="/assets/js/136.4c2976f3.js"><link rel="prefetch" href="/assets/js/137.af4cb7f3.js"><link rel="prefetch" href="/assets/js/138.2fca9d79.js"><link rel="prefetch" href="/assets/js/139.68b09848.js"><link rel="prefetch" href="/assets/js/14.10a5d7d6.js"><link rel="prefetch" href="/assets/js/140.83329d13.js"><link rel="prefetch" href="/assets/js/141.ce53e2d1.js"><link rel="prefetch" href="/assets/js/142.90de57a3.js"><link rel="prefetch" href="/assets/js/143.2ceb4dba.js"><link rel="prefetch" href="/assets/js/144.bb562f25.js"><link rel="prefetch" href="/assets/js/145.df7e837b.js"><link rel="prefetch" href="/assets/js/146.07c0d14b.js"><link rel="prefetch" href="/assets/js/147.29278301.js"><link rel="prefetch" href="/assets/js/148.214ec574.js"><link rel="prefetch" href="/assets/js/149.91a2b877.js"><link rel="prefetch" href="/assets/js/15.bbd8bb55.js"><link rel="prefetch" href="/assets/js/150.e682d7a9.js"><link rel="prefetch" href="/assets/js/151.7f512db9.js"><link rel="prefetch" href="/assets/js/152.bde5306e.js"><link rel="prefetch" href="/assets/js/153.ddd305dd.js"><link rel="prefetch" href="/assets/js/154.9ce2066d.js"><link rel="prefetch" href="/assets/js/155.6b4020df.js"><link rel="prefetch" href="/assets/js/156.e6646c1c.js"><link rel="prefetch" href="/assets/js/157.9b95854c.js"><link rel="prefetch" href="/assets/js/158.435aaec3.js"><link rel="prefetch" href="/assets/js/159.b19fafca.js"><link rel="prefetch" href="/assets/js/16.f42084e9.js"><link rel="prefetch" href="/assets/js/160.68710c08.js"><link rel="prefetch" href="/assets/js/161.f1af8369.js"><link rel="prefetch" href="/assets/js/162.48fcf4ef.js"><link rel="prefetch" href="/assets/js/163.06cd6567.js"><link rel="prefetch" href="/assets/js/164.769d0e38.js"><link rel="prefetch" href="/assets/js/165.cc786f58.js"><link rel="prefetch" href="/assets/js/166.8397915c.js"><link rel="prefetch" href="/assets/js/167.f330642c.js"><link rel="prefetch" href="/assets/js/168.7027298e.js"><link rel="prefetch" href="/assets/js/169.639addba.js"><link rel="prefetch" href="/assets/js/17.85928616.js"><link rel="prefetch" href="/assets/js/170.e464e07e.js"><link rel="prefetch" href="/assets/js/171.0c93f5f0.js"><link rel="prefetch" href="/assets/js/172.2bf96d48.js"><link rel="prefetch" href="/assets/js/173.d5f9688e.js"><link rel="prefetch" href="/assets/js/174.e2597c57.js"><link rel="prefetch" href="/assets/js/175.0db8dfdf.js"><link rel="prefetch" href="/assets/js/176.07d902fe.js"><link rel="prefetch" href="/assets/js/177.7ab96d33.js"><link rel="prefetch" href="/assets/js/178.336d8024.js"><link rel="prefetch" href="/assets/js/179.e3c6d94f.js"><link rel="prefetch" href="/assets/js/18.9934e679.js"><link rel="prefetch" href="/assets/js/180.df5400c0.js"><link rel="prefetch" href="/assets/js/181.0c7d5607.js"><link rel="prefetch" href="/assets/js/182.e888e6de.js"><link rel="prefetch" href="/assets/js/183.dce39526.js"><link rel="prefetch" href="/assets/js/184.431b197c.js"><link rel="prefetch" href="/assets/js/185.14793f4e.js"><link rel="prefetch" href="/assets/js/186.9568dba6.js"><link rel="prefetch" href="/assets/js/187.d3fd4988.js"><link rel="prefetch" href="/assets/js/188.aa6e0ffd.js"><link rel="prefetch" href="/assets/js/189.19e95b5f.js"><link rel="prefetch" href="/assets/js/19.ee04512f.js"><link rel="prefetch" href="/assets/js/190.0357c8ab.js"><link rel="prefetch" href="/assets/js/191.38a8d75e.js"><link rel="prefetch" href="/assets/js/192.88ad2e90.js"><link rel="prefetch" href="/assets/js/193.c40d1edf.js"><link rel="prefetch" href="/assets/js/194.5b1b41e8.js"><link rel="prefetch" href="/assets/js/195.760f24ae.js"><link rel="prefetch" href="/assets/js/196.6ffbac14.js"><link rel="prefetch" href="/assets/js/197.4a9b3a84.js"><link rel="prefetch" href="/assets/js/198.8f443da6.js"><link rel="prefetch" href="/assets/js/20.0aaa73a2.js"><link rel="prefetch" href="/assets/js/21.3f7c64b3.js"><link rel="prefetch" href="/assets/js/22.c0a7a6c8.js"><link rel="prefetch" href="/assets/js/23.f6eef774.js"><link rel="prefetch" href="/assets/js/24.bd35123b.js"><link rel="prefetch" href="/assets/js/25.8fcfb8ee.js"><link rel="prefetch" href="/assets/js/26.690a6980.js"><link rel="prefetch" href="/assets/js/27.19f45fe0.js"><link rel="prefetch" href="/assets/js/28.807fab84.js"><link rel="prefetch" href="/assets/js/29.0b6c2e62.js"><link rel="prefetch" href="/assets/js/3.579763e7.js"><link rel="prefetch" href="/assets/js/30.315a7e60.js"><link rel="prefetch" href="/assets/js/31.d5f68890.js"><link rel="prefetch" href="/assets/js/32.d1a6a3df.js"><link rel="prefetch" href="/assets/js/33.3f0448f8.js"><link rel="prefetch" href="/assets/js/34.3a80866b.js"><link rel="prefetch" href="/assets/js/35.365ffa2a.js"><link rel="prefetch" href="/assets/js/36.4a5a45e3.js"><link rel="prefetch" href="/assets/js/37.20e06547.js"><link rel="prefetch" href="/assets/js/38.4f772311.js"><link rel="prefetch" href="/assets/js/39.4c23d572.js"><link rel="prefetch" href="/assets/js/4.67785188.js"><link rel="prefetch" href="/assets/js/40.b322f222.js"><link rel="prefetch" href="/assets/js/41.66a29335.js"><link rel="prefetch" href="/assets/js/42.816686f3.js"><link rel="prefetch" href="/assets/js/43.000306d3.js"><link rel="prefetch" href="/assets/js/44.b02a4caf.js"><link rel="prefetch" href="/assets/js/45.8b184934.js"><link rel="prefetch" href="/assets/js/46.b6c9a6a4.js"><link rel="prefetch" href="/assets/js/47.866ecd20.js"><link rel="prefetch" href="/assets/js/48.d7b42bd4.js"><link rel="prefetch" href="/assets/js/49.2b954b65.js"><link rel="prefetch" href="/assets/js/5.cd5aa464.js"><link rel="prefetch" href="/assets/js/50.f8d28fa1.js"><link rel="prefetch" href="/assets/js/51.35847692.js"><link rel="prefetch" href="/assets/js/52.21725cad.js"><link rel="prefetch" href="/assets/js/53.523b2551.js"><link rel="prefetch" href="/assets/js/54.561bd3c9.js"><link rel="prefetch" href="/assets/js/55.0bf4813c.js"><link rel="prefetch" href="/assets/js/56.911d2a21.js"><link rel="prefetch" href="/assets/js/57.8be7f8ec.js"><link rel="prefetch" href="/assets/js/58.f7a8d551.js"><link rel="prefetch" href="/assets/js/59.a0099645.js"><link rel="prefetch" href="/assets/js/6.6af4007f.js"><link rel="prefetch" href="/assets/js/60.63904601.js"><link rel="prefetch" href="/assets/js/61.c222ba90.js"><link rel="prefetch" href="/assets/js/62.4512acf6.js"><link rel="prefetch" href="/assets/js/63.7fff9229.js"><link rel="prefetch" href="/assets/js/64.e13ed838.js"><link rel="prefetch" href="/assets/js/65.f5a83f6a.js"><link rel="prefetch" href="/assets/js/66.1eec7166.js"><link rel="prefetch" href="/assets/js/67.d08c50bb.js"><link rel="prefetch" href="/assets/js/68.eb803b99.js"><link rel="prefetch" href="/assets/js/69.2375bb03.js"><link rel="prefetch" href="/assets/js/7.df165250.js"><link rel="prefetch" href="/assets/js/70.33f1f6de.js"><link rel="prefetch" href="/assets/js/71.8bcdde8a.js"><link rel="prefetch" href="/assets/js/72.3c3c8dd8.js"><link rel="prefetch" href="/assets/js/73.e808082e.js"><link rel="prefetch" href="/assets/js/74.7ce1cdbc.js"><link rel="prefetch" href="/assets/js/75.21f62d3a.js"><link rel="prefetch" href="/assets/js/76.32052c0d.js"><link rel="prefetch" href="/assets/js/77.a41818c8.js"><link rel="prefetch" href="/assets/js/78.d68c2376.js"><link rel="prefetch" href="/assets/js/79.0b601b4b.js"><link rel="prefetch" href="/assets/js/80.a4f6779f.js"><link rel="prefetch" href="/assets/js/81.84bdd118.js"><link rel="prefetch" href="/assets/js/82.fc561f2d.js"><link rel="prefetch" href="/assets/js/83.2f4de683.js"><link rel="prefetch" href="/assets/js/84.11c361d5.js"><link rel="prefetch" href="/assets/js/85.906325b5.js"><link rel="prefetch" href="/assets/js/86.a2fa9aca.js"><link rel="prefetch" href="/assets/js/87.5caf9cf4.js"><link rel="prefetch" href="/assets/js/88.09b23cce.js"><link rel="prefetch" href="/assets/js/89.cb58b8bb.js"><link rel="prefetch" href="/assets/js/9.28706e90.js"><link rel="prefetch" href="/assets/js/90.9d0167ea.js"><link rel="prefetch" href="/assets/js/91.8c109a6b.js"><link rel="prefetch" href="/assets/js/92.c8dde281.js"><link rel="prefetch" href="/assets/js/93.ad100e18.js"><link rel="prefetch" href="/assets/js/94.15c9e757.js"><link rel="prefetch" href="/assets/js/95.eed9740d.js"><link rel="prefetch" href="/assets/js/96.1d2dc1ce.js"><link rel="prefetch" href="/assets/js/97.0f5f9b90.js"><link rel="prefetch" href="/assets/js/98.8555cbfc.js"><link rel="prefetch" href="/assets/js/99.fa14ad63.js">
    <link rel="stylesheet" href="/assets/css/0.styles.decdc3e0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/note/git/git-tips.html" class="nav-link">
  随记
</a></div><div class="nav-item"><a href="/study/javascript设计模式-张容铭/1-灵活的JavaScript.html" class="nav-link">
  学习笔记
</a></div> <a href="https://github.com/chenggang321/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/note/git/git-tips.html" class="nav-link">
  随记
</a></div><div class="nav-item"><a href="/study/javascript设计模式-张容铭/1-灵活的JavaScript.html" class="nav-link">
  学习笔记
</a></div> <a href="https://github.com/chenggang321/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>http</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>javascript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>react</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>前端工程化</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/前端工程化/2021-fe-predict.html" class="sidebar-link">ESM 大势所趋</a></li><li><a href="/note/前端工程化/bundle.html" class="sidebar-link">前端高级进阶：如何更好地优化打包资源</a></li><li><a href="/note/前端工程化/cdn.html" class="sidebar-link">使用 CDN 加速你的网站</a></li><li><a href="/note/前端工程化/deploy.html" class="sidebar-link">前端部署的发展历程</a></li><li><a href="/note/前端工程化/docker.html" class="sidebar-link">如何使用 docker 部署前端项目</a></li><li><a href="/note/前端工程化/eslint.html" class="sidebar-link">团队编码规范约束最佳实践</a></li><li><a href="/note/前端工程化/esm.html" class="sidebar-link">浏览器中的原生 ESM</a></li><li><a href="/note/前端工程化/feature-deploy.html" class="sidebar-link">CICD 下前端的多特性分支环境部署</a></li><li><a href="/note/前端工程化/http-cache.html" class="active sidebar-link">网站的缓存控制策略最佳实践及注意事项</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/前端工程化/http-cache.html#带指纹资源-永久缓存" class="sidebar-link">带指纹资源: 永久缓存</a></li><li class="sidebar-sub-header"><a href="/note/前端工程化/http-cache.html#非带指纹资源-每次进行新鲜度校验" class="sidebar-link">非带指纹资源: 每次进行新鲜度校验</a></li><li class="sidebar-sub-header"><a href="/note/前端工程化/http-cache.html#一定要为你的资源添加-cache-control-响应头" class="sidebar-link">一定要为你的资源添加 Cache-Control 响应头</a></li><li class="sidebar-sub-header"><a href="/note/前端工程化/http-cache.html#bundle-splitting-尽量减少资源变更" class="sidebar-link">Bundle Splitting：尽量减少资源变更</a></li><li class="sidebar-sub-header"><a href="/note/前端工程化/http-cache.html#小结" class="sidebar-link">小结</a></li></ul></li><li><a href="/note/前端工程化/local-https.html" class="sidebar-link">在本地环境为前端项目配置 https</a></li><li><a href="/note/前端工程化/npm-ci.html" class="sidebar-link">生产环境中使用 npm ci 代替 npm i</a></li><li><a href="/note/前端工程化/npm-install.html" class="sidebar-link">在生产环境中使你的 npm i 速度提升 50%</a></li><li><a href="/note/前端工程化/uglify.html" class="sidebar-link">javascript 代码是如何被压缩的</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>微信</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>文章整理</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="网站的缓存控制策略最佳实践及注意事项"><a href="#网站的缓存控制策略最佳实践及注意事项" class="header-anchor">#</a> 网站的缓存控制策略最佳实践及注意事项</h1> <p>对于一个网站来讲，性能关乎用户体验，你在更短的时间内打开网站，你将会留住更多的用户。如果你的页面十秒才能打开，那再好的用户交互也是徒然。</p> <p><img src="/assets/img/render.2d41753a.jpg" alt=""></p> <p>缓存控制是网站性能优化中至为常见及重要的一环，好的缓存控制，除了使网站在性能方面有所提升，在财务方面也有重要提升: 更好的缓存策略意味着更少的请求，更少的流量，更少的峰值带宽，从而节省一大笔服务器或者 CDN 的费用。</p> <p>缓存控制策略就是 http caching 的策略，化繁为简，最有效的策略往往是很简单的。在最简单的粗略下，你对 http cache 只需要了解一个 <code>Cache-Control</code> 的头部。</p> <p>一个较好的缓存策略只需要两部分，而它们只需要通过 <code>Cache-Control</code> 控制：</p> <ol><li>带指纹资源: 永久缓存</li> <li>非带指纹资源: 每次进行新鲜度校验</li></ol> <p>作图如下：</p> <p><img src="/assets/img/http-cache.be061628.png" alt="缓存控制策略"></p> <h2 id="带指纹资源-永久缓存"><a href="#带指纹资源-永久缓存" class="header-anchor">#</a> 带指纹资源: 永久缓存</h2> <div class="language- extra-class"><pre class="language-text"><code>Cache-Control: max-age=31536000
</code></pre></div><p>天下武功，无坚不摧，唯快不破。资源请求最快的方式就是不向服务器发起请求，通过以上响应头可以对资源设置永久缓存。</p> <ol><li>静态资源带有 hash 值，即指纹</li> <li>对资源设置一年过期时间，即 31536000，一般认为是永久缓存</li> <li>在永久缓存期间浏览器不需要向服务器发送请求</li></ol> <p>那为什么带有 hash 值的资源可以永久缓存呢？</p> <p><strong>因为该文件的内容发生变化时，会生成一个带有新的 hash 值的 URL。</strong> 前端将会发起一个新的 URL 的请求。</p> <h2 id="非带指纹资源-每次进行新鲜度校验"><a href="#非带指纹资源-每次进行新鲜度校验" class="header-anchor">#</a> 非带指纹资源: 每次进行新鲜度校验</h2> <div class="language- extra-class"><pre class="language-text"><code>Cache-Control: no-cache
</code></pre></div><ol><li>由于不带有指纹，每次都需要校验资源的新鲜度。(从缓存中取到资源，可能是过期资源)</li> <li>如果校验为最新资源，则从浏览器的缓存中加载资源</li></ol> <p><code>index.html</code> 为不带有指纹资源，如果把它置于缓存中，则如何保证服务器刷新数据时，被浏览器可以获取到新鲜的资源？</p> <p>因此，使用 <code>Cache-Control: no-cache</code> 时，客户端每次对服务器进行新鲜度校验。</p> <blockquote><p>PS：<a href="https://github.com/shfshanyue/Daily-Question/issues/207" target="_blank" rel="noopener noreferrer">no-cache 与 no-store 的区别是什么？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>即使每次校验新鲜度，也不需要每次都从服务器下载资源: <strong>如果浏览器/CDN上缓存经校验没有过期</strong>。这被称为协商缓存，此时 http 状态码返回 304，指 <code>Not Modified</code>，即没有变更。</p> <p><strong>幸运的是，关于协商缓存，你无需管理，也无需配置，</strong> <code>nginx</code> 或者一些 <code>OSS</code> 都会自动配置协商缓存。</p> <p>而对于协商缓存，也有它们自己的算法，协商缓存的背后基于响应头 <code>Last-Modified/ETag</code>。浏览器每次请求资源时，会携带上次服务器响应的 <code>ETag/Last-Modified</code> 作为标志，与服务端此时的 <code>ETag/Last-Modified</code> 作比较，来判断内容更改。</p> <blockquote><p><a href="https://github.com/shfshanyue/Daily-Question/issues/112" target="_blank" rel="noopener noreferrer">http 响应头中的 ETag 值是如何生成的？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>而在操作系统底层，<code>Last-Modified</code> 往往通过文件系统(file system)中的 <code>mtime</code> 属性生成。而 <code>ETag</code> 提供比 <code>Last-Modified</code> 更精细的检验粒度，由文件内容的 <code>hash</code> 或者 <code>mtime/size</code> 生成。当然，这是后话。</p> <h2 id="一定要为你的资源添加-cache-control-响应头"><a href="#一定要为你的资源添加-cache-control-响应头" class="header-anchor">#</a> 一定要为你的资源添加 Cache-Control 响应头</h2> <p>我会经常接触到一些网站，他们的资源文件并没有 <code>Cache-Control</code> 这个响应头。究其原因，在于缓存策略配置这个工作的职责不清，有时候它需要协调前端和运维。</p> <p><strong>那如果不添加 <code>Cache-Control</code> 这个响应头会怎么样？</strong></p> <p>是不是每次都会自动去服务器校验新鲜度，很可惜，不是。 <strong>此时会对资源进行强制缓存，而对不带有指纹信息的资源很有可能获取到过期资源。</strong> 如果过期资源存在于浏览器上，还可以通过强制刷新浏览器来获取最新资源。但是如果过期资源存在于 CDN 的边缘节点上，CDN 的刷新就会复杂很多，而且有可能需要多人协作解决。</p> <p><strong>那默认的强制缓存时间是多少</strong></p> <p>首先要明确两个响应头代表的含义：</p> <ol><li><code>Date</code>: 指源服务器响应报文生成的时间，差不多与发请求的时间等价</li> <li><code>Last-Modified</code>: 指静态资源上次修改的时间，取决于 <code>mtime</code></li></ol> <p><code>LM factor</code> 算法认为当请求服务器时，如果没有设置 <code>Cache-Control</code>，如果距离上次的 <code>Last-Modified</code> 越远，则生成的强制缓存时间越长。</p> <p>用公式表示如下，其中 <code>factor</code> 介于 0 与 1 之间：</p> <div class="language-js extra-class"><pre class="language-js"><code>MaxAge <span class="token operator">=</span> <span class="token punctuation">(</span>Date <span class="token operator">-</span> LastModified<span class="token punctuation">)</span> <span class="token operator">*</span> factor
</code></pre></div><p><img src="data:image/jpeg;base64,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" alt="LM factor"></p> <h2 id="bundle-splitting-尽量减少资源变更"><a href="#bundle-splitting-尽量减少资源变更" class="header-anchor">#</a> Bundle Splitting：尽量减少资源变更</h2> <p>得益于单页应用与前端工程化的发展，经过打包后，基本上所有资源都是带有指纹信息的，这意味着所有的资源都是能够设置永久缓存。打包策略如下图所示：</p> <p><img src="/assets/img/http-cache.be061628.png" alt="缓存控制策略"></p> <p>但仅仅如此了吗？</p> <p>如果你所有的 js 资源都打包成一个文件，它确实有永久缓存的优势。但是当有一行文件进行修改时，这一个大包的指纹信息发生改变，永久缓存失效。</p> <p>所以我们现在需要做到的是：当修改文件后，造成最小范围的缓存失效。<code>webpack</code> 等打包工具虽然在 <code>optimization</code> 上内置了很多性能优化，但它不会帮你做这件事，这件事情需要自己动手。</p> <p><img src="/assets/img/http-cache-2.182dbd90.png" alt="缓存控制策略"></p> <p>此时我们可以对资源进行分层次缓存的打包方案，这是一个建议方案：</p> <ol><li><code>webpack-runtime</code>: 应用中的 <code>webpack</code> 的版本比较稳定，分离出来，保证长久的永久缓存</li> <li><code>react/react-dom</code>: <code>react</code> 的版本更新频次也较低</li> <li><code>vendor</code>: 常用的第三方模块打包在一起，如 <code>lodash</code>，<code>classnames</code> 基本上每个页面都会引用到，但是它们的更新频率会更高一些。另外对低频次使用的第三方模块不要打进来</li> <li><code>pageA</code>: A 页面，当 A 页面的组件发生变更后，它的缓存将会失效</li> <li><code>pageB</code>: B 页面</li> <li><code>echarts</code>: 不常用且过大的第三方模块单独打包</li> <li><code>mathjax</code>: 不常用且过大的第三方模块单独打包</li> <li><code>jspdf</code>: 不常用且过大的第三方模块单独打包</li></ol> <p>随着 <code>http2</code> 的发展，特别是多路复用，初始页面的静态资源不受资源数量的影响。<strong>因此为了更好的缓存效果以及按需加载，也有很多方案建议把所有的第三方模块进行单模块打包。</strong></p> <h2 id="小结"><a href="#小结" class="header-anchor">#</a> 小结</h2> <p><img src="/assets/img/http-cache-2.182dbd90.png" alt="缓存控制策略"></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">3/1/2021, 1:40:08 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/note/前端工程化/feature-deploy.html" class="prev">
        CICD 下前端的多特性分支环境部署
      </a></span> <span class="next"><a href="/note/前端工程化/local-https.html">
        在本地环境为前端项目配置 https
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.4f4ef6e8.js" defer></script><script src="/assets/js/2.b1de68ec.js" defer></script><script src="/assets/js/8.ae557884.js" defer></script>
  </body>
</html>
