(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{375:function(e,t,r){e.exports=r.p+"assets/img/vercel-import.12048d94.png"},500:function(e,t,r){"use strict";r.r(t);var s=r(40),a=Object(s.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"使用-vercel-托管你的-api-服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-vercel-托管你的-api-服务"}},[e._v("#")]),e._v(" 使用 Vercel 托管你的 API 服务")]),e._v(" "),s("p",[s("code",[e._v("Vercel")]),e._v("，官网 "),s("a",{attrs:{href:"https://vercel.com",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://vercel.com"),s("OutboundLink")],1),e._v("，如同 "),s("code",[e._v("Netlify")]),e._v(" 一般，可以提供免费的前端应用托管及 Serverless Functions，甚至对开发者更加亲和与友好。")]),e._v(" "),s("p",[e._v("以下截图，可见一斑: "),s("strong",[e._v("当你部署前端应用时，它能够根据你使用的技术栈而自动设置构建命令及输出目录")])]),e._v(" "),s("p",[s("img",{attrs:{src:r(375),alt:"使用vercel导入项目"}})]),e._v(" "),s("p",[s("code",[e._v("Vercel")]),e._v(" 团队为了更好地推广他们的云服务，在开源中做了众多贡献，甚至盛名在外，以下几个 npm package 你即使没有使用过，但肯定会有所耳闻：")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://github.com/vercel/next.js",target:"_blank",rel:"noopener noreferrer"}},[e._v("next.js"),s("OutboundLink")],1),e._v(": 基于 React 的框架，也有可能是最好用的 SSR 方案")]),e._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/vercel/swr",target:"_blank",rel:"noopener noreferrer"}},[e._v("swr"),s("OutboundLink")],1),e._v(": 基于 React hooks 的数据请求库，可最大限度地充分利用缓存，并实现"),s("em",[e._v("乐观 UI")])]),e._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/vercel/serve",target:"_blank",rel:"noopener noreferrer"}},[e._v("serve"),s("OutboundLink")],1),e._v(": 适用于本地用于测试的静态文件托管服务")])]),e._v(" "),s("p",[e._v("我们可以使用 "),s("code",[e._v("Vercel")]),e._v("/"),s("code",[e._v("Netlify")]),e._v("/"),s("code",[e._v("AliOSS")]),e._v(" 以及各大云厂商的一些 Serverless 产品来几乎零成本地部署前端应用，但是"),s("strong",[e._v("偶尔也需要配套一些简单的 API 支持")]),e._v("。这个时候如果购买一台云服务器，就是杀鸡焉用宰牛刀了。")]),e._v(" "),s("p",[e._v("对于一款轻量的 API 服务，你可以选择各大云厂商的 Serverless 产品，但这里更推荐 "),s("code",[e._v("Vercel")]),e._v("。"),s("code",[e._v("Vercel")]),e._v(" 相对而言，学习成本低，部署方便，开源项目众多，更易上手，本篇文章介绍如何使用 "),s("code",[e._v("Vercel")]),e._v(" 来部署 API 服务")]),e._v(" "),s("h2",{attrs:{id:"hello-world"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hello-world"}},[e._v("#")]),e._v(" hello, world")]),e._v(" "),s("p",[e._v("本地项目新建 "),s("code",[e._v("/api/index.js")]),e._v("，文件内容如下，"),s("em",[e._v("标准的 HTTP Handler 的语法")]),e._v("，只要你熟悉 "),s("code",[e._v("http")]),e._v(" 模块，就可以很快上手:")]),e._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[e._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[e._v("exports")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[e._v("req"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" res")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=>")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" name "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'World'")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" req"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("query\n  res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("send")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[e._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("Hello ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[e._v("${")]),e._v("name"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[e._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("!")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[e._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),s("p",[s("strong",[e._v("文件编辑后，把代码上传到 Github，并打开 Vercel 控制台托管 Github 中的该项目，该 API 部署成功。")])]),e._v(" "),s("p",[e._v("虽然很简单，但是也有可能出错，以下是源码及演示地址:")]),e._v(" "),s("ul",[s("li",[e._v("源码: "),s("a",{attrs:{href:"https://github.com/shfshanyue/vercel-api",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/shfshanyue/vercel-api"),s("OutboundLink")],1)]),e._v(" "),s("li",[e._v("演示地址: "),s("a",{attrs:{href:"https://vercel-api.shanyue.vercel.app/api?name=shanyue",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://vercel-api.shanyue.vercel.app/api?name=shanyue"),s("OutboundLink")],1)])]),e._v(" "),s("p",[e._v("以上是使用 "),s("code",[e._v("Node")]),e._v(" 作为运行时的代码，但其实它还可以使用以下编程语言:")]),e._v(" "),s("ul",[s("li",[e._v("Node")]),e._v(" "),s("li",[e._v("Go")]),e._v(" "),s("li",[e._v("Python")]),e._v(" "),s("li",[e._v("Ruby")])]),e._v(" "),s("p",[e._v("Runtime 拥有更多的 API 及配置，可见文档：")]),e._v(" "),s("p",[s("a",{attrs:{href:"https://vercel.com/docs/runtimes#official-runtimes/node-js",target:"_blank",rel:"noopener noreferrer"}},[e._v("Vercel Runtimes"),s("OutboundLink")],1)]),e._v(" "),s("h2",{attrs:{id:"json-api-与-vercel-node-helper"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#json-api-与-vercel-node-helper"}},[e._v("#")]),e._v(" JSON API 与 Vercel Node Helper")]),e._v(" "),s("p",[e._v("后端作为数据提供者，一般以 Rest API 为标准并返回 JSON 数据，而前端解析数据并渲染页面。")]),e._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[e._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[e._v("exports")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[e._v("req"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" res")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=>")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("json")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    json"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),s("ul",[s("li",[e._v("演示地址: "),s("a",{attrs:{href:"https://vercel-api-shanyue.vercel.app/api/json",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://vercel-api-shanyue.vercel.app/api/json"),s("OutboundLink")],1)])]),e._v(" "),s("p",[e._v("在 vercel 中通过 "),s("code",[e._v("res.json(obj)")]),e._v(" 来返回 JSON 数据，像这样的简单方便的函数并不为原生的 "),s("a",{attrs:{href:"https://nodejs.org/api/http.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("HTTP Handler"),s("OutboundLink")],1),e._v(" 所提供。而由 vercel 提供的 "),s("a",{attrs:{href:"https://vercel.com/docs/runtimes#official-runtimes/node-js/node-js-request-and-response-objects",target:"_blank",rel:"noopener noreferrer"}},[e._v("Node.js Helper"),s("OutboundLink")],1),e._v(" 实现:")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("req.query")]),e._v(": An object containing the request's query string, or {} if the request does not have a query string.")]),e._v(" "),s("li",[s("code",[e._v("req.cookies")]),e._v(": An object containing the cookies sent by the request, or {} if the request contains no cookies.")]),e._v(" "),s("li",[s("code",[e._v("req.body")]),e._v(": An object containing the body sent by the request, or null if no body is sent.")]),e._v(" "),s("li",[s("code",[e._v("res.status(code)")]),e._v(": A function to set the status code sent with the response where code must be a valid HTTP status code. Returns res for chaining.")]),e._v(" "),s("li",[s("code",[e._v("res.send(body)")]),e._v(": A function to set the content of the response where body can be a string, an object or a Buffer.")]),e._v(" "),s("li",[s("code",[e._v("res.json(obj)")]),e._v(": A function to send a JSON response where obj is the JSON object to send.")]),e._v(" "),s("li",[s("code",[e._v("res.redirect(url)")]),e._v(': A function to redirect to the URL derived from the specified path with status code "307 Temporary Redirect".')]),e._v(" "),s("li",[s("code",[e._v("res.redirect(statusCode, url)")]),e._v(": A function to redirect to the URL derived from the specified path, with specified HTTP status code.")])]),e._v(" "),s("h2",{attrs:{id:"本地调试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#本地调试"}},[e._v("#")]),e._v(" 本地调试")]),e._v(" "),s("p",[e._v("TODO")]),e._v(" "),s("h2",{attrs:{id:"router-rewrite-与-redirect"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#router-rewrite-与-redirect"}},[e._v("#")]),e._v(" Router: Rewrite 与 Redirect")]),e._v(" "),s("p",[e._v("部署完成后，默认的路由路径是 "),s("code",[e._v("/api")]),e._v("，此时 "),s("code",[e._v("/")]),e._v(" 会"),s("em",[e._v("显示文件目录")]),e._v("，如果想更好地扩展路由呢？")]),e._v(" "),s("p",[e._v("通过配置文件 "),s("code",[e._v("vercel.json")]),e._v(" 配置 "),s("code",[e._v("Rewrites/Redirects")]),e._v(" 可完成此功能")]),e._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[e._v('"rewrites"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[e._v('"source"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"/"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[e._v('"destination"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"/api"')]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),s("h2",{attrs:{id:"小而有创意的-api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#小而有创意的-api"}},[e._v("#")]),e._v(" 小而有创意的 API")]),e._v(" "),s("p",[e._v("由于 "),s("code",[e._v("Vercel")]),e._v(" 这个 API 的本质也是 "),s("code",[e._v("Serverless")]),e._v("，最适合做一些轻量的若存储的服务。我也收集了一些小而有创意的服务，如下所列")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://github.com/anuraghazra/github-readme-stats",target:"_blank",rel:"noopener noreferrer"}},[e._v("github-readme-stats"),s("OutboundLink")],1),e._v(": Github Readme 的统计数据图表")]),e._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/badges/shields",target:"_blank",rel:"noopener noreferrer"}},[e._v("shields.io"),s("OutboundLink")],1),e._v(": 设计各种漂亮的 Badge")]),e._v(" "),s("li",[s("a",{attrs:{href:"http://goqr.me/api/",target:"_blank",rel:"noopener noreferrer"}},[e._v("qrcode api"),s("OutboundLink")],1),e._v(": 生成二维码")]),e._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/willnorris/imageproxy",target:"_blank",rel:"noopener noreferrer"}},[e._v("imageproxy"),s("OutboundLink")],1),e._v(": 一个对图片进行处理的服务，也可以用来反防盗链")]),e._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/itsthatguy/avatars-api-middleware",target:"_blank",rel:"noopener noreferrer"}},[e._v("avatar api"),s("OutboundLink")],1),e._v(": 生成指定或随机的头像")])])])}),[],!1,null,null,null);t.default=a.exports}}]);