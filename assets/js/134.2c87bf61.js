(window.webpackJsonp=window.webpackJsonp||[]).push([[134],{560:function(a,t,e){"use strict";e.r(t);var s=e(40),r=Object(s.a)({},(function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"记录一个有关-curl-和重定向的小问题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#记录一个有关-curl-和重定向的小问题"}},[a._v("#")]),a._v(" 记录一个有关 curl 和重定向的小问题")]),a._v(" "),e("p",[a._v("今天在工作时遇到一个有关解压的问题，先来还原问题")]),a._v(" "),e("p",[e("strong",[a._v("今天在解压一个压缩包时解压失败，以下是命令以及失败提示")])]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" -O https://github.com/alibaba/canal/releases/download/canal-1.1.3/canal.deployer-1.1.3.tar.gz\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" -zxvf canal.deployer-1.1.3.tar.gz\n\ngzip: stdin: not "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("in")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("gzip")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("format")]),a._v("\ntar: Child returned status "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\ntar: Error is not recoverable: exiting now\n")])])]),e("blockquote",[e("p",[a._v("造成这个问题的原因以及解决方案很简单，对你很有可能没有借鉴意义。不过寻找原因的过程以及从这个问题上学到的东西还是有点意思的")])]),a._v(" "),e("h2",{attrs:{id:"stackoverflow"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#stackoverflow"}},[a._v("#")]),a._v(" StackOverflow")]),a._v(" "),e("p",[a._v("作为程序员的两大利器之一，"),e("code",[a._v("StackOverflow")]),a._v(" 和 "),e("code",[a._v("github")]),a._v("。第一步就跟踪到了 "),e("code",[a._v("StackOverflow")]),a._v("，查找到了这个问题，问题描述一模一样")]),a._v(" "),e("blockquote",[e("p",[e("a",{attrs:{href:"https://stackoverflow.com/questions/15744023/how-to-extract-filename-tar-gz-file",target:"_blank",rel:"noopener noreferrer"}},[a._v("How to extract filename.tar.gz file"),e("OutboundLink")],1)])]),a._v(" "),e("p",[a._v("首先，使用 "),e("code",[a._v("file")]),a._v(" 查看文件的类型")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("file")]),a._v(" canal.deployer-1.1.3.tar.gz\ncanal.deployer-1.1.3.tar.gz: HTML document, ASCII text, with very long lines, with no line terminators\n")])])]),e("p",[a._v("如果没有使用 "),e("code",[a._v("gzip")]),a._v(" 压缩，那需要使用 "),e("code",[a._v("tar")]),a._v(" 解压的时候，去掉 "),e("code",[a._v("-z")]),a._v(" 参数。")]),a._v(" "),e("p",[e("strong",[a._v("无果。")])]),a._v(" "),e("blockquote",[e("p",[a._v("这里安利一个工具，"),e("code",[a._v("explainshell")]),a._v(" 可以以图文可视化 shell 命令各个参数的意义，当参数较多，命令较长时，非常试用，强烈推荐。\n"),e("a",{attrs:{href:"https://www.explainshell.com/explain?cmd=tar+-zxvf+canal.deployer-1.1.3.tar.gz",target:"_blank",rel:"noopener noreferrer"}},[a._v("explainshell"),e("OutboundLink")],1)])]),a._v(" "),e("p",[a._v("不过，我从 "),e("code",[a._v("file")]),a._v(" 命令中意识到有可能文件有问题，因为它的输出是 "),e("code",[a._v("HTML document")]),a._v("，且是纯文本类型。")]),a._v(" "),e("h2",{attrs:{id:"从源头出发"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#从源头出发"}},[a._v("#")]),a._v(" 从源头出发")]),a._v(" "),e("p",[a._v("当我意识到文件有问题时，觉得应该从文件源找出问题。文件是通过 "),e("code",[a._v("curl")]),a._v(" 下载而来，我添加了 "),e("code",[a._v("-v")]),a._v(" 参数用来查看 http 详细的报文。")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" -Ov https://github.com/alibaba/canal/releases/download/canal-1.1.3/canal.deployer-1.1.3.tar.gz\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" User-Agent: curl/7.29.0\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" Host: github.com\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" Accept: */*\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" HTTP/1.1 "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("302")]),a._v(" Found\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" Date: Fri, "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("12")]),a._v(" Apr "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("2019")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("13")]),a._v(":20:31 GMT\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" Content-Type: text/html"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("charset")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("utf-8\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".\n")])])]),e("p",[a._v("定位到问题了，地址做了重定向，但是 "),e("code",[a._v("curl")]),a._v(" 并没有跟踪重定向后的 "),e("code",[a._v("Location")]),a._v("。因此，刚才的压缩包其实是关于重定向的响应，所以文件类型是 "),e("code",[a._v("HTML document")]),a._v("。")]),a._v(" "),e("p",[a._v("为了验证一下，我查看了压缩包的内容。")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" canal.deployer-1.1.3.tar.gz\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("html"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("body"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("You are being "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("a "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("href")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"https://github-production-release-asset-2e65be.s3.amazonaws.com/7587038/6df81900-56c6-11e9-8140-7d9ae25b1ca8?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAIWNJYAX4CSVEH53A%2F20190412%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20190412T132310Z&amp;X-Amz-Expires=300&amp;X-Amz-Signature=3cb0943449b8d86bf6292b399409fddfa9fbef1c646c20910f10ae7fe836e53e&amp;X-Amz-SignedHeaders=host&amp;actor_id=0&amp;response-content-disposition=attachment%3B%20filename%3Dcanal.deployer-1.1.3.tar.gz&amp;response-content-type=application%2Foctet-stream"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("redirected"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("/a"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("."),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("/body"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("/html"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),e("p",[e("strong",[a._v("果然如此，我突然意识到在刚开始 "),e("code",[a._v("curl")]),a._v(" 成功后根据 "),e("code",[a._v("Received")]),a._v(" 的大小就可以定位到问题了。不过我一般自动忽略 "),e("code",[a._v("curl")]),a._v(" 的输出，而且当下载东西的时候，我一般就切窗口了...")])]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 接收到的文件只有 616 个字节大小")]),a._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" -O https://github.com/alibaba/canal/releases/download/canal-1.1.3/canal.deployer-1.1.3.tar.gz\n% Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n"),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("100")]),a._v("   "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("616")]),a._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("   "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("616")]),a._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("     "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("444")]),a._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v(" --:--:--  "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v(":00:01 --:--:--   "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("444")]),a._v("\n")])])]),e("p",[a._v("找到了问题就很好解决了: "),e("strong",[a._v("没有跟踪重定向")])]),a._v(" "),e("h2",{attrs:{id:"问题解决"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#问题解决"}},[a._v("#")]),a._v(" 问题解决")]),a._v(" "),e("p",[a._v("找到 "),e("code",[a._v("curl")]),a._v(" 追踪重定向的参数，重新下载问题解决。")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 找到参数为 -L")]),a._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" --help "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" -e follow -e redirect\n-L, --location      Follow redirects "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("H"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n     --max-redirs NUM  Maximum number of redirects allowed "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("H"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n     --post301       Do not switch to GET after following a "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("301")]),a._v(" redirect "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("H"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n     --post302       Do not switch to GET after following a "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("302")]),a._v(" redirect "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("H"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n     --post303       Do not switch to GET after following a "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("303")]),a._v(" redirect "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("H"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n     --proto-redir PROTOCOLS  Enable/disable specified protocols on redirect\n     --stderr FILE   Where to redirect stderr. - means stdout\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" -OL https://github.com/alibaba/canal/releases/download/canal-1.1.3/canal.deployer-1.1.3.tar.gz\n")])])]),e("h2",{attrs:{id:"反思"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#反思"}},[a._v("#")]),a._v(" 反思")]),a._v(" "),e("p",[a._v("如果仔细一点，刚开始 "),e("code",[a._v("curl")]),a._v(" 时发现 "),e("code",[a._v("Received")]),a._v(" 的大小，估计几秒钟就能解决问题。不过总的来说还是略有收获。")]),a._v(" "),e("ol",[e("li",[e("code",[a._v("explainshell")]),a._v(" 解析复杂的 linux 命令")]),a._v(" "),e("li",[e("code",[a._v("curl -OL <url>")]),a._v(" 追踪重定向并下载到本地")]),a._v(" "),e("li",[e("code",[a._v("file <file>")]),a._v(" 查看文件类型")]),a._v(" "),e("li",[a._v("使用 "),e("code",[a._v("grep")]),a._v(" 匹配多个关键字\n"),e("ol",[e("li",[e("code",[a._v('grep "PATTERN1\\|PATTERN2" FILE')])]),a._v(" "),e("li",[e("code",[a._v('grep -E "PATTERN1|PATTERN2" FILE')])]),a._v(" "),e("li",[e("code",[a._v("grep -e PATTERN1 -e PATTERN2 FILE")])]),a._v(" "),e("li",[e("code",[a._v('egrep "PATTERN1|PATTERN2" FILE')])])])])]),a._v(" "),e("h2",{attrs:{id:"参考"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[a._v("#")]),a._v(" 参考")]),a._v(" "),e("ul",[e("li",[a._v("https://www.shellhacks.com/grep-or-grep-and-grep-not-match-multiple-patterns/")])])])}),[],!1,null,null,null);t.default=r.exports}}]);