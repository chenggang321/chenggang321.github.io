(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{374:function(t,s,e){t.exports=e.p+"assets/img/nginx-https.9ac0e595.jpg"},486:function(t,s,e){"use strict";e.r(s);var a=e(40),n=Object(a.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"在-kubernetes-中自动为域名配置-https"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在-kubernetes-中自动为域名配置-https"}},[t._v("#")]),t._v(" 在 kubernetes 中自动为域名配置 https")]),t._v(" "),a("p",[t._v("随着 web 的发展，"),a("code",[t._v("https")]),t._v(" 对于现代网站来说是必不可少的。如果你想得到一个免费的证书，那么 "),a("a",{attrs:{href:"https://letsencrypt.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Let's Encrypt"),a("OutboundLink")],1),t._v(" 是一个不错的选择，它的主要目的是推进网站 "),a("code",[t._v("https")]),t._v(" 的进程。")]),t._v(" "),a("blockquote",[a("p",[t._v("感谢 Let's Encrypt 的免费证书")])]),t._v(" "),a("p",[t._v("借助 "),a("code",[t._v("helm")]),t._v("，在 "),a("code",[t._v("k8s cluster")]),t._v(" 中为域名配置 "),a("code",[t._v("https")]),t._v(" 将会变得非常简单，部署资源成功后在 "),a("code",[t._v("k8s")]),t._v(" 中为 "),a("code",[t._v("Ingress")]),t._v(" 配置证书将会变得非常容易: 只需要在 Ingress 中多添加两行代码")]),t._v(" "),a("p",[a("strong",[t._v("本篇文章将介绍如何只需要三步为你的域名配置上 https")])]),t._v(" "),a("p",[a("strong",[t._v("在本篇文章之前，假设此时你已经能够配置 "),a("code",[t._v("Ingress")]),t._v(" 并成功访问到你的域名")]),t._v("，如果没有，你可以参考本系列文章的以上几篇")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://shanyue.tech/k8s/pod",target:"_blank",rel:"noopener noreferrer"}},[t._v("部署你的第一个应用: Pod，Application 与 Service"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://shanyue.tech/k8s/ingress",target:"_blank",rel:"noopener noreferrer"}},[t._v("通过外部域名访问你的应用: Ingress"),a("OutboundLink")],1)])]),t._v(" "),a("h2",{attrs:{id:"_01-使用-helm-部署-cert-manager"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_01-使用-helm-部署-cert-manager"}},[t._v("#")]),t._v(" 01 使用 helm 部署 cert-manager")]),t._v(" "),a("p",[t._v("我们选择这个 "),a("code",[t._v("helm chart")]),t._v(" "),a("a",{attrs:{href:"https://hub.helm.sh/charts/jetstack/cert-manager",target:"_blank",rel:"noopener noreferrer"}},[t._v("jetstack/cert-manager"),a("OutboundLink")],1),t._v(" 部署 "),a("code",[t._v("https")]),t._v("。目前，在 github 上，该仓库 "),a("a",{attrs:{href:"https://github.com/jetstack/cert-manager",target:"_blank",rel:"noopener noreferrer"}},[t._v("jetstack/cert-manager"),a("OutboundLink")],1),t._v(" 已拥有 4.4K Star。")]),t._v(" "),a("p",[t._v("如果想使用 "),a("code",[t._v("let's encrypt")]),t._v(" 自动为 "),a("code",[t._v("Ingress")]),t._v(" 配置 "),a("code",[t._v("https")]),t._v("。在部署时需要为 helm chart 指定以下参数。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("ingressShim.defaultIssuerName"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("letsencrypt-prod\ningressShim.defaultIssuerKind"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("Issuer\n")])])]),a("p",[t._v("这里有关于 "),a("a",{attrs:{href:"https://docs.cert-manager.io/en/latest/reference/issuers.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Issuers的文档"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("部署过程如下，这里使用了 "),a("code",[t._v("helm v3")]),t._v(" 进行部署")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 部署前需要一些 crd")]),t._v("\n$ kubectl apply -f https://raw.githubusercontent.com/jetstack/cert-manager/release-0.11/deploy/manifests/00-crds.yaml\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 为 helm 添加 repo")]),t._v("\n$ helm repo "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" jetstack https://charts.jetstack.io\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 使用 helm v3 部署，指定参数")]),t._v("\n$ helm "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" cert-manager jetstack/cert-manager --set "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ingressShim.defaultIssuerName=letsencrypt-prod,ingressShim.defaultIssuerKind=Issuer"')]),t._v("\nNAME: cert-manager\nLAST DEPLOYED: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("-10-26 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v(":27:56.488948248 +0800 CST "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("m")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("+2.081581159\nNAMESPACE: default\nSTATUS: deployed\nNOTES:\ncert-manager has been deployed successfully"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("\n\nIn order to begin issuing certificates, you will need to "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" up a ClusterIssuer\nor Issuer resource "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("for example, by creating a "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'letsencrypt-staging'")]),t._v(" issuer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(".\n\nMore information on the different types of issuers and how to configure them\ncan be found "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" our documentation:\n\nhttps://docs.cert-manager.io/en/latest/reference/issuers.html\n\nFor information on how to configure cert-manager to automatically provision\nCertificates "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" Ingress resources, take a "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("look")]),t._v(" at the "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("ingress-shim"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("\ndocumentation:\n\nhttps://docs.cert-manager.io/en/latest/reference/ingress-shim.html\n")])])]),a("p",[t._v("校验状态，查看刚才部署 "),a("code",[t._v("crd")]),t._v(" 与 "),a("code",[t._v("pod")]),t._v(" 的状态，校验是否成功")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ kubectl get crd\nNAME                                  CREATED AT\ncertificaterequests.cert-manager.io   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("-10-26T01:16:21Z\ncertificates.cert-manager.io          "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("-10-26T01:16:21Z\nchallenges.acme.cert-manager.io       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("-10-26T01:16:21Z\nclusterissuers.cert-manager.io        "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("-10-26T01:16:24Z\nissuers.cert-manager.io               "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("-10-26T01:16:24Z\norders.acme.cert-manager.io           "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("-10-26T01:16:21Z\n\n$ kubectl get pods\nNAME                                             READY   STATUS    RESTARTS   AGE\ncert-manager-5d8fd69d88-s7dtg                    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          57s\ncert-manager-cainjector-755bbf9c6b-ctkdb         "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          57s\ncert-manager-webhook-76954fcbcd-h4hrx            "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          57s\n")])])]),a("h2",{attrs:{id:"_02-配置-acme-issuers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_02-配置-acme-issuers"}},[t._v("#")]),t._v(" 02 配置 ACME Issuers")]),t._v(" "),a("p",[t._v("指定 kind 为 "),a("code",[t._v("Issuer")]),t._v("，并修改以下邮箱为自己的邮箱，Issuer 资源配置如下")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cert"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("manager.io/v1alpha2\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Issuer\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" letsencrypt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("prod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("acme")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The ACME server URL")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//acme"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v02.api.letsencrypt.org/directory\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Email address used for ACME registration")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("email")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" example@shanyue.tech\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Name of a secret used to store the ACME account private key")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("privateKeySecretRef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" letsencrypt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("prod\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Enable the HTTP-01 challenge provider")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("solvers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http01")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ingress")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n")])])]),a("p",[t._v("使用 "),a("code",[t._v("kubectl apply -f")]),t._v(" 部署生效")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ kubectl apply -f letsencrypt-issue.yaml\n")])])]),a("h2",{attrs:{id:"_03-为-ingress-添加-annotation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_03-为-ingress-添加-annotation"}},[t._v("#")]),t._v(" 03 为 Ingress 添加 annotation")]),t._v(" "),a("p",[t._v("在部署 Ingress 时指定 "),a("code",[t._v("annotations")]),t._v(" 就可以很方便地配置证书")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("annotations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kubernetes.io/ingress.class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nginx"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cert-manager.io/issuer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"letsencrypt-prod"')]),t._v("\n")])])]),a("p",[t._v("或者")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("annotations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kubernetes.io/ingress.class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nginx"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kubernetes.io/tls-acme")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'true'")]),t._v("\n")])])]),a("p",[t._v("关于 "),a("code",[t._v("Ingress")]),t._v(" 的完整配置如下，你也可以在我的github上查看 "),a("code",[t._v("Deployment")]),t._v("，"),a("code",[t._v("Service")]),t._v(" 到 "),a("code",[t._v("Ingress")]),t._v(" 完整的配置: "),a("a",{attrs:{href:"https://github.com/shfshanyue/learn-k8s/blob/master/conf/nginx.yaml",target:"_blank",rel:"noopener noreferrer"}},[t._v("shfshanyue/learn-k8s:/conf/nginx.yaml"),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.k8s.io/v1beta1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Ingress\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ingress\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("annotations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kubernetes.io/ingress.class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nginx"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cert-manager.io/issuer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"letsencrypt-prod"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tls")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" nginx.xiange.tech\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("secretName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("tls\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rules")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx.xiange.tech\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("backend")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("service\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("servicePort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /\n")])])]),a("p",[t._v("校验 "),a("code",[t._v("certificate")]),t._v(" 状态，"),a("code",[t._v("Ready")]),t._v(" 为 True")]),t._v(" "),a("blockquote",[a("p",[t._v("由于镜像在 quay.io 中，pull image 的时间过慢，有可能需要十分钟")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ kubectl get certificate\nNAME        READY   SECRET      AGE\nnginx-tls   True    nginx-tls   44h\n\n$ kubectl describe certificate nginx-tls\nName:         nginx-tls\nNamespace:    default\nLabels:       "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nAnnotations:  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nAPI Version:  cert-manager.io/v1alpha2\nKind:         Certificate\nMetadata:\n  Creation Timestamp:  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("-10-26T13:30:06Z\n  Generation:          "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  Owner References:\n    API Version:           extensions/v1beta1\n    Block Owner Deletion:  "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    Controller:            "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    Kind:                  Ingress\n    Name:                  nginx-service-ingress\n    "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("UID")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v("                   c9abc7b7-45da-431b-b732-e535a809dfdd\n  Resource Version:        "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2822740")]),t._v("\n  Self Link:               /apis/cert-manager.io/v1alpha2/namespaces/default/certificates/nginx-tls\n  "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("UID")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v("                     ccb3aa54-e967-4813-acbe-41d9801f29a6\nSpec:\n  Dns Names:\n    nginx.xiange.tech\n  Issuer Ref:\n    Group:      cert-manager.io\n    Kind:       Issuer\n    Name:       letsencrypt-prod\n  Secret Name:  nginx-tls\nStatus:\n  Conditions:\n    Last Transition Time:  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("-10-26T13:43:02Z\n    Message:               Certificate is up to "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("date")]),t._v(" and has not expired\n    Reason:                Ready\n    Status:                True\n    Type:                  Ready\n  Not After:               "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v("-01-24T12:43:01Z\nEvents:                    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),a("p",[t._v("访问 "),a("code",[t._v("Ingress")]),t._v(" 中配置的域名，Chrome 浏览器中左上角的小锁提示 "),a("code",[t._v("https")]),t._v(" 配置成功")]),t._v(" "),a("p",[a("img",{attrs:{src:e(374),alt:"https 配置成功"}})]),t._v(" "),a("h2",{attrs:{id:"参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://docs.cert-manager.io/en/latest/tasks/issuing-certificates/ingress-shim.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Automatically creating Certificates for Ingress resources"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://docs.cert-manager.io/en/latest/tasks/issuers/setup-acme/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Setting up ACME Issuers"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://akomljen.com/get-automatic-https-with-lets-encrypt-and-kubernetes-ingress/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Get Automatic HTTPS with Let's Encrypt and Kubernetes Ingress"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=n.exports}}]);