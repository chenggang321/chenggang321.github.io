(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{457:function(t,a,v){"use strict";v.r(a);var _=v(40),e=Object(_.a)({},(function(){var t=this,a=t.$createElement,v=t._self._c||a;return v("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[v("h1",{attrs:{id:"隔离级"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#隔离级"}},[t._v("#")]),t._v(" 隔离级")]),t._v(" "),v("p",[t._v("如果你对它不够了解，就有可能无意中在线上造成一些奇怪的数据问题，而且有可能这种 BUG 是偶发的，是无法被捕捉到的，间接造成了排查问题的成本过大。")]),t._v(" "),v("p",[t._v("而本篇文章就是告诉你会产生什么问题，在哪个阶段会产生问题以及如何避免。")]),t._v(" "),v("h2",{attrs:{id:"什么是隔离级"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#什么是隔离级"}},[t._v("#")]),t._v(" 什么是隔离级")]),t._v(" "),v("p",[v("code",[t._v("ACID")]),t._v(" 代表事务的四种特征，其中 "),v("code",[t._v("I")]),t._v(" 指的是 "),v("code",[t._v("Isolate")]),t._v("，即隔离性。一个事务在最终提交之前对其它事务是不可见的，这就是隔离性。")]),t._v(" "),v("p",[t._v("但事实上，当并发过高时，多个事务的操作涉及到相同行的数据时，单个事务对其它事务并不一定完全不可见，此时可能看见事务提交前的中间状态，于是有了"),v("strong",[t._v("隔离级")]),t._v("。")]),t._v(" "),v("h2",{attrs:{id:"四种隔离级别"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#四种隔离级别"}},[t._v("#")]),t._v(" 四种隔离级别")]),t._v(" "),v("p",[t._v("总共有四种隔离级别，隔离级越高，事务的不可见性更好，但随之带来的是数据库更高的开销。")]),t._v(" "),v("h3",{attrs:{id:"read-uncommited-未提交读-与-dirty-read-脏读"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#read-uncommited-未提交读-与-dirty-read-脏读"}},[t._v("#")]),t._v(" Read Uncommited (未提交读) 与 Dirty Read (脏读)")]),t._v(" "),v("blockquote",[v("p",[t._v("事务未提交前对其它事务也是可见的")])]),t._v(" "),v("p",[v("strong",[t._v("首先说明，这是唯一可能产生脏读的隔离级，也是在生产环境中基本不会用的隔离级。")])]),t._v(" "),v("p",[t._v("那什么是脏读呢？脏读可以读取到未提交的数据，这无论如何也是不能够忍受的。")]),t._v(" "),v("p",[t._v("以下是脏读的示例，A与B代表两个事务")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("事务A")]),t._v(" "),v("th",[t._v("事务B")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("开启事务")]),t._v(" "),v("td",[t._v("开启事务")])]),t._v(" "),v("tr",[v("td"),t._v(" "),v("td",[t._v("查询孙悟空的阳寿为300")])]),t._v(" "),v("tr",[v("td"),t._v(" "),v("td",[t._v("把孙悟空的阳寿改为无限大")])]),t._v(" "),v("tr",[v("td",[v("strong",[t._v("查询孙悟空的阳寿为无限大 (脏读)")])]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("提交事务")]),t._v(" "),v("td",[t._v("提交事务")])])])]),t._v(" "),v("h3",{attrs:{id:"read-commited-提交读-与-nonrepetable-read-不可重复读"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#read-commited-提交读-与-nonrepetable-read-不可重复读"}},[t._v("#")]),t._v(" Read Commited (提交读) 与 Nonrepetable Read (不可重复读)")]),t._v(" "),v("blockquote",[v("p",[t._v("事务只能读取已提交的事务，它解决了脏读的问题")])]),t._v(" "),v("p",[t._v("这是 "),v("code",[t._v("postgres")]),t._v(" 的默认隔离级别，也是大部分后端项目所设置数据库的隔离级别，因此对于它所产生的问题要格外注意。")]),t._v(" "),v("p",[t._v("正因为它是提交读，当一个多次读操作的事务执行过程中夹杂了一个写操作的事务，此时可能出现不可重复读的问题。")]),t._v(" "),v("p",[t._v("不可重复度，即在同一事务中，两次读操作的结果不同。相对而言，这种情况出现的可能还比较苛刻。")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("事务A")]),t._v(" "),v("th",[t._v("事务B")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("开启事务")]),t._v(" "),v("td",[t._v("开启事务")])]),t._v(" "),v("tr",[v("td",[t._v("查询孙悟空的阳寿为300")]),t._v(" "),v("td",[t._v("查询孙悟空的阳寿为300")])]),t._v(" "),v("tr",[v("td"),t._v(" "),v("td",[t._v("把孙悟空的阳寿改为无限大")])]),t._v(" "),v("tr",[v("td"),t._v(" "),v("td",[t._v("提交事务")])]),t._v(" "),v("tr",[v("td",[v("strong",[t._v("查询孙悟空的阳寿为无限大 (不可重复读)")])]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("提交事务")]),t._v(" "),v("td")])])]),t._v(" "),v("h3",{attrs:{id:"repetable-read-可重复读-与-phantom-read-幻读"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#repetable-read-可重复读-与-phantom-read-幻读"}},[t._v("#")]),t._v(" Repetable Read (可重复读) 与 Phantom Read (幻读)")]),t._v(" "),v("h2",{attrs:{id:"可能产生的-bug"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#可能产生的-bug"}},[t._v("#")]),t._v(" 可能产生的 BUG")]),t._v(" "),v("h2",{attrs:{id:"三种"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#三种"}},[t._v("#")]),t._v(" 三种")]),t._v(" "),v("h2",{attrs:{id:"实践"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#实践"}},[t._v("#")]),t._v(" 实践")]),t._v(" "),v("h3",{attrs:{id:"如何在数据库中查看当前的隔离级"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#如何在数据库中查看当前的隔离级"}},[t._v("#")]),t._v(" 如何在数据库中查看当前的隔离级")]),t._v(" "),v("div",{staticClass:"language-sql extra-class"},[v("pre",{pre:!0,attrs:{class:"language-sql"}},[v("code",[t._v("\n")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);