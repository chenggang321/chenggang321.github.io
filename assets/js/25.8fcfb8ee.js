(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{323:function(e,o,t){e.exports=t.p+"assets/img/ctop.d90d9261.png"},442:function(e,o,t){e.exports=t.p+"assets/img/htop.ea40ebb0.jpg"},606:function(e,o,t){"use strict";t.r(o);var r=t(40),_=Object(r.a)({},(function(){var e=this,o=e.$createElement,r=e._self._c||o;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",{attrs:{id:"docker-compose-编排架构简介"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-编排架构简介"}},[e._v("#")]),e._v(" docker-compose 编排架构简介")]),e._v(" "),r("p",[e._v("首先需要说一下服务器配置，只要你的服务器配置高于1核2G，均可使用该基础设施来管理你的个人服务器，你可以在服务中部署几个应用，并且把该服务器作为你的测试服务器来使用。但是你的应用过多，或者QPS稍大，可以相应地加强服务器配置。")]),e._v(" "),r("p",[e._v("现在来简述下一个低配置的个人服务器的基础设施架构图")]),e._v(" "),r("p",[r("img",{attrs:{src:"https://raw.githubusercontent.com/shfshanyue/graph/master/draw/docker-compose.jpg",alt:"docker compose architecture"}})]),e._v(" "),r("h2",{attrs:{id:"traefik"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#traefik"}},[e._v("#")]),e._v(" Traefik")]),e._v(" "),r("p",[e._v("架构图的最核心位置是 "),r("code",[e._v("traefik")]),e._v("，一个 "),r("code",[e._v("Edge Router")]),e._v("，它也是该基础设施的重点。")]),e._v(" "),r("p",[e._v("服务器内的所有应用服务，如 "),r("code",[e._v("postgres")]),e._v("，"),r("code",[e._v("redis")]),e._v(" 以及自己所写的应用服务，都与 "),r("code",[e._v("traefik")]),e._v(" 置于一个网络下，"),r("strong",[e._v("它们共同组成了一个集群")]),e._v("。")]),e._v(" "),r("p",[e._v("以下是我使用它的理由")]),e._v(" "),r("ul",[r("li",[e._v("热更新配置，无需重启")]),e._v(" "),r("li",[e._v("自动服务发现与负载均衡")]),e._v(" "),r("li",[e._v("TLS/SSL 证书的自动生成")]),e._v(" "),r("li",[e._v("与 "),r("code",[e._v("docker")]),e._v(" 的完美集成，基于 "),r("code",[e._v("container label")]),e._v(" 的配置")]),e._v(" "),r("li",[e._v("漂亮的 "),r("code",[e._v("dashboard")]),e._v(" 界面")])]),e._v(" "),r("p",[e._v("关于 "),r("code",[e._v("traefik")]),e._v(" 可以参考文章 "),r("a",{attrs:{href:"https://github.com/shfshanyue/op-note/blob/master/traefik.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("Traefik 简易配置及入门"),r("OutboundLink")],1)]),e._v(" "),r("h2",{attrs:{id:"请求路由"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#请求路由"}},[e._v("#")]),e._v(" 请求路由")]),e._v(" "),r("p",[e._v("从图左侧可以看出，请求路由分为两大类。当然他们的路由规则都是通过 "),r("code",[e._v("traefik")]),e._v(" 来控制")]),e._v(" "),r("ul",[r("li",[r("code",[e._v("shanyue.tech")]),e._v(" 通过公有的域名提供公有的、可供互联网访问的服务。如博客，微信公众号开发，个人网站及后端服务等等")]),e._v(" "),r("li",[r("code",[e._v("shanyue.local")]),e._v(" 通过私有的域名提供私有的、只供内部进群访问的服务，保证安全性。如数据库，redis等等")])]),e._v(" "),r("h2",{attrs:{id:"应用与服务"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#应用与服务"}},[e._v("#")]),e._v(" 应用与服务")]),e._v(" "),r("p",[e._v("在图右侧，都是个人服务器里的应用，它们均是通过 "),r("code",[e._v("docker-compose")]),e._v(" 部署。你可以在 "),r("a",{attrs:{href:"https://github.com/shfshanyue/op-note/tree/master/compose",target:"_blank",rel:"noopener noreferrer"}},[e._v("shfshanyue/op-note:compose"),r("OutboundLink")],1),e._v(" 中找到所有的配置文件")]),e._v(" "),r("p",[e._v("只需要 "),r("code",[e._v("docker-compose up -d")]),e._v(" 即可启动")]),e._v(" "),r("ul",[r("li",[r("code",[e._v("whoami")]),e._v(": 一个用以测试的服务，测试负载均衡及路由匹配等")]),e._v(" "),r("li",[r("code",[e._v("dns")]),e._v(": 集群内 DNS 服务，给自己的私有域名 "),r("code",[e._v("shanyue.local")]),e._v(" 做解析")]),e._v(" "),r("li",[r("code",[e._v("openvpn")]),e._v("：与个人笔记本搭建局域网，方便访问个人服务器上服务以及调试页面")]),e._v(" "),r("li",[r("code",[e._v("postgres")])]),e._v(" "),r("li",[r("code",[e._v("redis")])])]),e._v(" "),r("p",[e._v("本章将会讲述如何部署它们以及它们的配置文件。不过在此之前，你需要对 "),r("code",[e._v("docker")]),e._v(" 以及 "),r("code",[e._v("docker-compose")]),e._v(" 了解一些，参考以前文章")]),e._v(" "),r("ol",[r("li",[r("a",{attrs:{href:"https://github.com/shfshanyue/op-note/blob/master/docker.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("docker 简易入门"),r("OutboundLink")],1)]),e._v(" "),r("li",[r("a",{attrs:{href:"https://github.com/shfshanyue/op-note/blob/master/docker-compose.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("docker compose 简易入门"),r("OutboundLink")],1)])]),e._v(" "),r("h2",{attrs:{id:"私有服务"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#私有服务"}},[e._v("#")]),e._v(" 私有服务")]),e._v(" "),r("p",[r("code",[e._v("shanyue.local")]),e._v(" 路由所提供的服务都是私有服务，通过 "),r("code",[e._v("dnsmasq")]),e._v(" 与 "),r("code",[e._v("openvpn")]),e._v(" 在个人笔记本上进行访问。")]),e._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://github.com/shfshanyue/op-note/blob/master/dnsmasq.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("搭建集群内部 DNS 服务器"),r("OutboundLink")],1)]),e._v(" "),r("li",[r("a",{attrs:{href:"https://github.com/shfshanyue/op-note/blob/master/openvpn.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("使用 openvpn 访问集群私有服务"),r("OutboundLink")],1)])]),e._v(" "),r("h2",{attrs:{id:"监控"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#监控"}},[e._v("#")]),e._v(" 监控")]),e._v(" "),r("p",[e._v("个人服务器自然也需要监控，如负载，CPU，内存，网络，磁盘等。如果你服务器配置较高，且中有重要应用在跑时可以使用 "),r("code",[e._v("prometheus")]),e._v(" 与 "),r("code",[e._v("grafana")]),e._v(" 搭建一套监控系统，但是作为一个轻量的个人服务器，这样就显得小题大做，而且消耗极其资源。")]),e._v(" "),r("p",[e._v("关于该云服务器的 "),r("code",[e._v("metric")]),e._v(" 可以直接在阿里云的监控面板上进行查看。但对于轻量的个人服务器，可以使用 "),r("code",[e._v("htop")]),e._v(" 与 "),r("code",[e._v("ctop")]),e._v(" 两个简单的命令行工具来搞定")]),e._v(" "),r("ul",[r("li",[r("code",[e._v("htop")]),e._v(" 监控进程指标")]),e._v(" "),r("li",[r("code",[e._v("ctop")]),e._v(" 监控容器指标")])]),e._v(" "),r("p",[r("img",{attrs:{src:t(442),alt:"htop"}}),e._v(" "),r("img",{attrs:{src:t(323),alt:"ctop"}})])])}),[],!1,null,null,null);o.default=_.exports}}]);