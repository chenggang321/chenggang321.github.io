(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{319:function(t,s,a){t.exports=a.p+"assets/img/action-result.cd3043ed.png"},384:function(t,s,a){t.exports=a.p+"assets/img/action-select.23735177.jpg"},385:function(t,s,a){t.exports=a.p+"assets/img/action-setup.8e889165.jpg"},386:function(t,s,a){t.exports=a.p+"assets/img/action-start.4b488ba0.png"},387:function(t,s,a){t.exports=a.p+"assets/img/action-secret.68096ff9.png"},503:function(t,s,a){"use strict";a.r(s);var n=a(40),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"github-actions-入门指南及实践"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#github-actions-入门指南及实践"}},[t._v("#")]),t._v(" github actions 入门指南及实践")]),t._v(" "),n("p",[t._v("自从 "),n("code",[t._v("github")]),t._v(" 提供了 "),n("code",[t._v("github actions")]),t._v(" 后，个人或者依赖于 "),n("code",[t._v("github")]),t._v(" 的公司可以考虑把持续集成方案迁到 "),n("code",[t._v("github actions")]),t._v("。")]),t._v(" "),n("p",[n("code",[t._v("github")]),t._v(" 会提供一个以下配置的服务器做为 runner，可以说相当良心了。")]),t._v(" "),n("ul",[n("li",[t._v("2-core CPU")]),t._v(" "),n("li",[t._v("7 GB of RAM memory")]),t._v(" "),n("li",[t._v("14 GB of SSD disk space")])]),t._v(" "),n("p",[t._v("另外如果你有网络时延的需求，（比如推送及拉取镜像时产生的网络时延），你也可以自建 runner。")]),t._v(" "),n("p",[t._v("本文将介绍 "),n("code",[t._v("github actions")]),t._v(" 的用法，以及如何使用它自动部署个人博客或者前端应用")]),t._v(" "),n("h2",{attrs:{id:"快速开始"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#快速开始"}},[t._v("#")]),t._v(" 快速开始")]),t._v(" "),n("p",[t._v("在 "),n("code",[t._v("github")]),t._v(" 上进入个人仓库，找到 "),n("code",[t._v("Actions")]),t._v(" 的标签页")]),t._v(" "),n("p",[n("img",{attrs:{src:a(384),alt:"Actions"}})]),t._v(" "),n("p",[t._v("如果你是一个前端项目，可以使用 "),n("code",[t._v("Node.js")]),t._v(" 的模板，点击 "),n("code",[t._v("Set up this workflow")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(385),alt:"Actions Setup"}})]),t._v(" "),n("p",[t._v("此时生成了一个文件 "),n("code",[t._v(".github/workflows/nodejs.yaml")]),t._v("，修改内容如下")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Git Action Test\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("push"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jobs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runs-on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ubuntu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("latest\n\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("steps")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actions/checkout@v1\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Use Node.js 10.x\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actions/setup"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node@v1\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("node-version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10.x\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" npm install"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" build\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),n("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v("\n        npm install\n        npm run build --if-present")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("CI")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])])]),n("p",[t._v("执行 "),n("code",[t._v("git push")]),t._v(" 操作，此时可以在 "),n("code",[t._v("github")]),t._v(" 的 "),n("code",[t._v("Actions")]),t._v(" 标签页看到执行结果")]),t._v(" "),n("p",[n("img",{attrs:{src:a(386),alt:"Actions Start"}})]),t._v(" "),n("h2",{attrs:{id:"术语"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#术语"}},[t._v("#")]),t._v(" 术语")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("runner")]),t._v(": github 分配的用来执行 CI/CD 的构建服务器 (也可以自建 runner)")]),t._v(" "),n("li",[n("code",[t._v("workflow")]),t._v(": CI/CD 的工作流")]),t._v(" "),n("li",[n("code",[t._v("job")]),t._v(": 任务，比如构建，测试和部署。每个 "),n("code",[t._v("workflow")]),t._v(" 由多个 "),n("code",[t._v("job")]),t._v(" 组成")]),t._v(" "),n("li",[n("code",[t._v("step")]),t._v(": 每个 "),n("code",[t._v("job")]),t._v(" 由多个 "),n("code",[t._v("step")]),t._v(" 组成")])]),t._v(" "),n("h2",{attrs:{id:"配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[t._v("#")]),t._v(" 配置")]),t._v(" "),n("p",[t._v("参考官方文档: "),n("a",{attrs:{href:"https://help.github.com/en/actions/automating-your-workflow-with-github-actions/workflow-syntax-for-github-actions",target:"_blank",rel:"noopener noreferrer"}},[t._v("Workflow syntax for GitHub Actions"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("以下是常用到的配置")]),t._v(" "),n("h3",{attrs:{id:"on"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#on"}},[t._v("#")]),t._v(" on")]),t._v(" "),n("p",[t._v("该 CI/CD 触发时的事件。如果需要上传代码自动部署的功能时，应该选择 "),n("code",[t._v("on: push")])]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" push\n")])])]),n("p",[t._v("更多事件可以参考官方文档 "),n("a",{attrs:{href:"https://help.github.com/en/actions/automating-your-workflow-with-github-actions/events-that-trigger-workflows#about-workflow-events",target:"_blank",rel:"noopener noreferrer"}},[t._v("Events that trigger workflows"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("另外，我们可以利用 "),n("code",[t._v("issues")]),t._v(" 事件做很多事情，如邮件通知之类")]),t._v(" "),n("blockquote",[n("p",[t._v("如果是 Issue 类博客，则可以通过监听 "),n("code",[t._v("issues.opened")]),t._v(" 事件，调用 "),n("code",[t._v("github api")]),t._v("，自动生成网址博客")])]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("issues")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("types")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("opened"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" edited"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" milestoned"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),n("h3",{attrs:{id:"jobs"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#jobs"}},[t._v("#")]),t._v(" jobs")]),t._v(" "),n("p",[t._v("一个 CI/CD 的工作流有许多 "),n("code",[t._v("jobs")]),t._v(" 组成，比如最典型的 job 是 "),n("code",[t._v("lint")]),t._v("，"),n("code",[t._v("test")]),t._v("，"),n("code",[t._v("build")]),t._v(" 或者 "),n("code",[t._v("deploy")]),t._v("。")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jobs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("test")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("deploy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n")])])]),n("p",[t._v("所有的 "),n("code",[t._v("job")]),t._v(" 都是并行的，但往往会有依赖关系："),n("strong",[t._v("你总得通过测试了，才能再去部署吧")])]),t._v(" "),n("h3",{attrs:{id:"jobs-job-id-needs"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#jobs-job-id-needs"}},[t._v("#")]),t._v(" jobs.<job_id>.needs")]),t._v(" "),n("p",[n("code",[t._v("needs")]),t._v(" 确定 "),n("code",[t._v("job")]),t._v(" 的依赖关系")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jobs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("test")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("deploy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("needs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" test\n")])])]),n("h3",{attrs:{id:"jobs-job-id-runs-on"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#jobs-job-id-runs-on"}},[t._v("#")]),t._v(" jobs.<job_id>.runs-on")]),t._v(" "),n("p",[t._v("当你使用 "),n("code",[t._v("github actions")]),t._v(" 时，github 会十分大方的给你分配一个配置还不错的服务器作为构建服务器，用来跑你的 "),n("code",[t._v("workflow")])]),t._v(" "),n("ul",[n("li",[t._v("2-core CPU")]),t._v(" "),n("li",[t._v("7 GB of RAM memory")]),t._v(" "),n("li",[t._v("14 GB of SSD disk space")])]),t._v(" "),n("p",[t._v("恩，比我自己的服务器要强")]),t._v(" "),n("p",[t._v("使用 "),n("code",[t._v("runs-on")]),t._v(" 指定服务器系统，用的最多的应该就是 "),n("code",[t._v("ubuntu-latest")]),t._v(" 了")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runs-on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ubuntu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("latest\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runs-on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" windows"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("latest\n")])])]),n("h3",{attrs:{id:"jobs-job-id-steps"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#jobs-job-id-steps"}},[t._v("#")]),t._v(" jobs.<job_id>.steps")]),t._v(" "),n("p",[t._v("即某个任务的一系列动作，如部署一个前端需要安装依赖，编译代码等等")]),t._v(" "),n("h3",{attrs:{id:"jobs-job-id-steps-name"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#jobs-job-id-steps-name"}},[t._v("#")]),t._v(" jobs.<job_id>.steps.name")]),t._v(" "),n("p",[t._v("为 step 指定一个名称，将会在 "),n("code",[t._v("github action")]),t._v(" 的控制台中显示")]),t._v(" "),n("h3",{attrs:{id:"jobs-job-id-steps-run"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#jobs-job-id-steps-run"}},[t._v("#")]),t._v(" jobs.<job_id>.steps.run")]),t._v(" "),n("p",[t._v("该 step 需要在 "),n("code",[t._v("shell")]),t._v(" 中执行的命令")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 单行")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Install Dependencies\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" npm install\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 多行")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Install and Build\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),n("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v("\n    npm install\n    npm run build")]),t._v("\n")])])]),n("h3",{attrs:{id:"jobs-job-id-steps-uses"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#jobs-job-id-steps-uses"}},[t._v("#")]),t._v(" jobs.<job_id>.steps.uses")]),t._v(" "),n("p",[t._v("选择一个 "),n("code",[t._v("action")]),t._v("，可以理解为若干 "),n("code",[t._v("steps.run")]),t._v("，有利于代码复用。这也是 "),n("code",[t._v("github action")]),t._v(" 最主要的功能。")]),t._v(" "),n("p",[t._v("如果你想找一个好用的 "),n("code",[t._v("github action")]),t._v("，可以在 "),n("code",[t._v("github marketplace")]),t._v(" 浏览并检索")]),t._v(" "),n("p",[t._v("这是一个在当前操作系统中安装 "),n("code",[t._v("node:10")]),t._v(" 的 action 示例")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" use Node.js 10.x\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actions/setup"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node@v1\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("node-version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10.x\n")])])]),n("p",[t._v("当然，这里怎么能少得了 "),n("code",[t._v("docker")]),t._v(" 的身影呢，在 "),n("code",[t._v("actions")]),t._v(" 中也可以使用 "),n("code",[t._v("docker")]),t._v("。如果对 "),n("code",[t._v("docker")]),t._v(" 不太了解，可以看我的文章: "),n("a",{attrs:{href:"https://github.com/shfshanyue/op-note/blob/master/docker.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker 简易入门"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("以下是 "),n("code",[t._v("npm install")]),t._v(" 的一个示例")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jobs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("steps")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Install\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" docker"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("alpine\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("args")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" npm install\n")])])]),n("h2",{attrs:{id:"secret-and-context"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#secret-and-context"}},[t._v("#")]),t._v(" secret and context")]),t._v(" "),n("p",[t._v("如何在 "),n("code",[t._v("github action")]),t._v(" 上访问敏感数据？如使用 "),n("code",[t._v("ssh")]),t._v(" 登录时如何维护密码。")]),t._v(" "),n("p",[t._v("我们可以在 github repo 上依次点击 "),n("code",[t._v("Settings")]),t._v(" -> "),n("code",[t._v("Secrets")]),t._v(" 设置 "),n("code",[t._v("secret")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(387),alt:"Actions Secrect"}})]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" setup aliyun oss\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" manyuanrong/setup"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ossutil@master\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("endpoint")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" oss"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("beijing.aliyuncs.com\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("access-key-id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.OSS_KEY_ID "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("access-key-secret")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.OSS_KEY_SECRET "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("这里的 "),n("code",[t._v("secret")]),t._v(" 就是一种 "),n("code",[t._v("context")]),t._v("，描述 CI/CD 一个 "),n("code",[t._v("workflow")]),t._v(" 中的上下文信息，使用 "),n("code",[t._v("$"+t._s(t.expression))]),t._v(" 语法表示。除了 "),n("code",[t._v("secret")]),t._v("，还有")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("github")]),t._v(": "),n("code",[t._v("workflow")]),t._v(" 的信息，如 "),n("code",[t._v("github.sha")]),t._v(" 可以获取当前的 "),n("code",[t._v("commit SHA")]),t._v("，我们可以利用它为 "),n("code",[t._v("sentry")]),t._v(" 或者 "),n("code",[t._v("docker image")]),t._v(" 打入版本号")]),t._v(" "),n("li",[n("code",[t._v("env")]),t._v(": 环境变量")]),t._v(" "),n("li",[n("code",[t._v("job")]),t._v(": 当前执行 "),n("code",[t._v("job")]),t._v(" 的信息，如 "),n("code",[t._v("job.status")]),t._v(" 表示当前 "),n("code",[t._v("job")]),t._v(" 的执行状态")]),t._v(" "),n("li",[n("code",[t._v("matrix")]),t._v(": 描述一些构建信息，如 "),n("code",[t._v("node")]),t._v(" 以及 "),n("code",[t._v("os")]),t._v(" 版本号")])]),t._v(" "),n("p",[t._v("更多 "),n("code",[t._v("context")]),t._v(" 信息可以参考官方文档 "),n("a",{attrs:{href:"https://help.github.com/en/actions/automating-your-workflow-with-github-actions/contexts-and-expression-syntax-for-github-actions#job-context",target:"_blank",rel:"noopener noreferrer"}},[t._v("Contexts and expression syntax for GitHub Actions"),n("OutboundLink")],1)]),t._v(" "),n("h2",{attrs:{id:"实践一-博客自动部署"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#实践一-博客自动部署"}},[t._v("#")]),t._v(" 实践一：博客自动部署")]),t._v(" "),n("p",[t._v("我的博客目前托管在阿里云OSS上，以下 "),n("code",[t._v("action.yaml")]),t._v(" 描述了自动部署的流程。可以参考我的配置 "),n("a",{attrs:{href:"https://github.com/shfshanyue/blog/blob/master/.github/workflows/nodejs.yml",target:"_blank",rel:"noopener noreferrer"}},[t._v("shfshanyue/blog"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("strong",[t._v("关于托管在阿里云OSS的细节，可以参考 "),n("RouterLink",{attrs:{to:"/no-vps/deploy-fe-with-alioss.html"}},[t._v("在阿里云OSS托管你的前端应用")])],1)]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" deploy to aliyun oss\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("push"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jobs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runs-on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ubuntu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("latest\n\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("steps")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 切代码到 runner")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actions/checkout@v1\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("submodules")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 下载 git submodule")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" srt32/git"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("actions@v0.0.3\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("args")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" git submodule update "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("init "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("recursive\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 使用 node:10")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" use Node.js 10.x\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actions/setup"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node@v1\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("node-version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10.x\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# npm install")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" npm install and build\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),n("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v("\n        npm install\n        npm run build")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("CI")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置阿里云OSS的 id/secret，存储到 github 的 secrets 中")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" setup aliyun oss\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" manyuanrong/setup"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ossutil@master\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("endpoint")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" oss"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("beijing.aliyuncs.com\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("access-key-id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.OSS_KEY_ID "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("access-key-secret")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.OSS_KEY_SECRET "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cp files to aliyun\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ossutil cp "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("rf .vuepress/dist oss"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//shanyue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("blog/\n")])])]),n("p",[t._v("部署成功")]),t._v(" "),n("p",[n("img",{attrs:{src:a(319),alt:"部署成功"}})]),t._v(" "),n("h2",{attrs:{id:"实践二-github-readme-自动生成"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#实践二-github-readme-自动生成"}},[t._v("#")]),t._v(" 实践二：Github Readme 自动生成")]),t._v(" "),n("p",[t._v("2020年8月份，就是我裸辞的那个月，Github 上线了个人主页功能，即创建 Github 用户名的同名 Repo，其中的 Readme.md 就是自己的个人主页。例如我，创建一个 "),n("code",[t._v("shfshanyue/shfshanyue")]),t._v(" 的仓库，既可以通过 "),n("code",[t._v("Readme.md")]),t._v(" 来创建个人主页")]),t._v(" "),n("p",[t._v("此时涌现了各种各样的 Github Actions 来自定义个人主页，大致思路如下：")]),t._v(" "),n("ol",[n("li",[t._v("Github API 获取自身 Github 动态，写入指定格式的 Readme")]),t._v(" "),n("li",[t._v("Github Actions 自动提交代码")])]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://github.com/abhisheknaiidu/awesome-github-profile-readme#github-actions-",target:"_blank",rel:"noopener noreferrer"}},[t._v("优秀 Github 个人主页的 Actions"),n("OutboundLink")],1)])]),t._v(" "),n("p",[t._v("其中一个 "),n("a",{attrs:{href:"https://github.com/anmol098/waka-readme-stats",target:"_blank",rel:"noopener noreferrer"}},[t._v("waka-readme-stats"),n("OutboundLink")],1),t._v("，可制作以下漂亮的个人主页")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("📅 I'm Most Productive on Sundays\n\nMonday       "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v(" commits     ███░░░░░░░░░░░░░░░░░░░░░░   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("13.19")]),t._v("% \nTuesday      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("85")]),t._v(" commits     █████░░░░░░░░░░░░░░░░░░░░   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("22.43")]),t._v("% \nWednesday    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("56")]),t._v(" commits     ███░░░░░░░░░░░░░░░░░░░░░░   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14.78")]),t._v("% \nThursday     "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("44")]),t._v(" commits     ███░░░░░░░░░░░░░░░░░░░░░░   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("11.61")]),t._v("% \nFriday       "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("28")]),t._v(" commits     █░░░░░░░░░░░░░░░░░░░░░░░░   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("7.39")]),t._v("% \nSaturday     "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v(" commits     ██░░░░░░░░░░░░░░░░░░░░░░░   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("7.92")]),t._v("% \nSunday       "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("86")]),t._v(" commits     █████░░░░░░░░░░░░░░░░░░░░   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("22.69")]),t._v("%\n")])])]),n("h2",{attrs:{id:"实践三-定时任务的脚本服务器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#实践三-定时任务的脚本服务器"}},[t._v("#")]),t._v(" 实践三：定时任务的脚本服务器")]),t._v(" "),n("p",[n("strong",[t._v("这简直是在薅羊毛啊！")])]),t._v(" "),n("p",[t._v("先献上一个使用了 Github Actions 的工具："),n("a",{attrs:{href:"https://github.com/RayWangQvQ/BiliBiliTool",target:"_blank",rel:"noopener noreferrer"}},[t._v("B站自动签到工具"),n("OutboundLink")],1),t._v("。")]),t._v(" "),n("blockquote",[n("p",[t._v("通过GitHub Actions实现每日线上自动运行任务：每日自动登录、观看、分享、投币视频，获取每日任务的满额经验，轻松升级Level 6，实现自动领取大会员权益、月底自动为自己充电等功能。")])]),t._v(" "),n("p",[t._v("关于其它有趣的可薅羊毛的定时任务，就需要充分发挥你的想象力了！以下是可以做的几个有意思的事情")]),t._v(" "),n("ol",[n("li",[t._v("微信公众号定时上传素材")]),t._v(" "),n("li",[t._v("各种社交平台自动签到")])])])}),[],!1,null,null,null);s.default=e.exports}}]);