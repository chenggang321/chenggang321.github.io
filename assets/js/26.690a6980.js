(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{444:function(s,t,a){s.exports=a.p+"assets/img/linux_perf_tools_full.b07ca95e.png"},445:function(s,t,a){s.exports=a.p+"assets/img/htop.d1f19abb.png"},618:function(s,t,a){"use strict";a.r(t);var e=a(40),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"linux-指标监控小记"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#linux-指标监控小记"}},[s._v("#")]),s._v(" linux 指标监控小记")]),s._v(" "),e("p",[s._v("自开始负责生产环境部署，中间遇到了若干线上环境内存以及CPU的问题。由于微服务以及容器的流行，现在已经可以很方便的使用 "),e("code",[s._v("K8s")]),s._v(" + "),e("code",[s._v("prometheus")]),s._v(" + "),e("code",[s._v("grafana")]),s._v(" + "),e("code",[s._v("alert")]),s._v(" 的方式进行监控，这足以覆盖大部分场景。")]),s._v(" "),e("p",[s._v("最重要的事情已经交由最适合的组件去做，然而了解一些在裸机上的命令以及指标也是必不可少的：")]),s._v(" "),e("ol",[e("li",[s._v("了解监控什么指标")]),s._v(" "),e("li",[s._v("平时写一些脚本也经常会 OOM 或者 CPU 使用率过高")])]),s._v(" "),e("p",[s._v("先以一张来自 "),e("a",{attrs:{href:"http://www.brendangregg.com/linuxperf.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("linuxperf"),e("OutboundLink")],1),s._v(" 的图作为大纲，我试着对一些指标进行整理，以备不时之需。")]),s._v(" "),e("p",[e("img",{attrs:{src:a(444),alt:"linux performance tools"}})]),s._v(" "),e("ul",[e("li",[s._v("原文地址: "),e("a",{attrs:{href:"https://shanyue.tech/op/linux-monitor.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("linux 各项指标监控小记"),e("OutboundLink")],1),s._v(" · "),e("a",{attrs:{href:"https://github.com/shfshanyue/op-note/blob/master/linux-monitor.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("github"),e("OutboundLink")],1)]),s._v(" "),e("li",[s._v("系列文章: "),e("a",{attrs:{href:"https://shanyue.tech/op/",target:"_blank",rel:"noopener noreferrer"}},[s._v("服务器运维笔记"),e("OutboundLink")],1),s._v(" · "),e("a",{attrs:{href:"https://github.com/shfshanyue/op-note",target:"_blank",rel:"noopener noreferrer"}},[s._v("github"),e("OutboundLink")],1)])]),s._v(" "),e("h2",{attrs:{id:"htop-top"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#htop-top"}},[s._v("#")]),s._v(" htop/top")]),s._v(" "),e("p",[e("img",{attrs:{src:a(445),alt:"htop"}})]),s._v(" "),e("p",[s._v("htop 足以覆盖大多数指标，详细直接查看帮助即可。")]),s._v(" "),e("blockquote",[e("p",[s._v("这里的 TIME 指的是 CPU 时间\nhtop 里的 task 数指的是进程树，top 里的 task 数指的是进程树 + 内核线程数，参考文章 "),e("a",{attrs:{href:"https://www.cnblogs.com/arnoldlu/p/8336998.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.cnblogs.com/arnoldlu/p/8336998.html"),e("OutboundLink")],1)])]),s._v(" "),e("ol",[e("li",[s._v("sort: by mem/cpu/state. 根据进程状态排序也至关重要，特别在 load average 过高的时候。根据内存以及CPU使用率排序用以定位高资源占用者。")]),s._v(" "),e("li",[s._v("filter")]),s._v(" "),e("li",[s._v("fields")]),s._v(" "),e("li",[s._v("process/ count")]),s._v(" "),e("li",[s._v("...")])]),s._v(" "),e("h2",{attrs:{id:"cpu-基本信息"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cpu-基本信息"}},[s._v("#")]),s._v(" CPU 基本信息")]),s._v(" "),e("p",[s._v("在 linux 中一切皆文件，查看 "),e("code",[s._v("/proc/cpuinfo")]),s._v(" 查看信息。另有衍生问题")]),s._v(" "),e("ul",[e("li",[s._v("如何查看 CPU 个数")]),s._v(" "),e("li",[s._v("如何查看 CPU model")]),s._v(" "),e("li",[s._v("如何查看 CPU 主频")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /proc/cpuinfo\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /proc/stat\n")])])]),e("h2",{attrs:{id:"平均负载-load-average"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#平均负载-load-average"}},[s._v("#")]),s._v(" 平均负载 (load average)")]),s._v(" "),e("p",[s._v("使用 "),e("code",[s._v("uptime")]),s._v(" 和 "),e("code",[s._v("w")]),s._v(" 可打印出系统过去 1, 5, 15 分钟内的平均负载。同时，你可以使用 "),e("code",[s._v("sar -q")]),s._v(" 查看动态的平均负载。")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("uptime")]),s._v("\n "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":28:49 up "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("290")]),s._v(" days, "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":25,  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" user,  load average: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.39")]),s._v(", "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.64")]),s._v(", "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.55")]),s._v("\n$ w\n "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":29:50 up "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("290")]),s._v(" days, "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":26,  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" user,  load average: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.58")]),s._v(", "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.63")]),s._v(", "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.61")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("     TTY      FROM          LOGIN@   IDLE   JCPU   PCPU WHAT\nroot     pts/0    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".0.1    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":27    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(".00s  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".05s  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".00s tmux a\n")])])]),e("p",[s._v("在 "),e("code",[s._v("uptime")]),s._v(" 的 man 手册中这么解释平均负载")]),s._v(" "),e("blockquote",[e("p",[s._v("System load averages is the average number of processes that are either in a runnable or uninterruptable state.")])]),s._v(" "),e("p",[s._v("翻译过来就是指系统中处于可运行状态和不可中断状态的平均进程数。")]),s._v(" "),e("p",[s._v("对于 4 核的 CPU，如果平均负载高于 4 就代表负载过高")]),s._v(" "),e("h2",{attrs:{id:"动态平均负载"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#动态平均负载"}},[s._v("#")]),s._v(" 动态平均负载")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ sar -q "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\nLinux "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.10")]),s._v(".0-957.21.3.el7.x86_64 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("shanyue"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("/21/19        _x86_64_        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" CPU"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":55:52      runq-sz  plist-sz   ldavg-1   ldavg-5  ldavg-15   blocked\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":55:53            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("464")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.07")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.11")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.13")]),s._v("         "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":55:54            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("464")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.06")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.10")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.13")]),s._v("         "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":55:55            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("464")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.06")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.10")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.13")]),s._v("         "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":55:56            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("464")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.06")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.10")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.13")]),s._v("         "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":55:57            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("464")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.06")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.10")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.13")]),s._v("         "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":55:57            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("464")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.06")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.10")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.13")]),s._v("         "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nAverage:            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("464")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.06")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.10")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.13")]),s._v("         "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n")])])]),e("h2",{attrs:{id:"cpu-使用率"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cpu-使用率"}},[s._v("#")]),s._v(" CPU 使用率")]),s._v(" "),e("p",[s._v("可以直接使用 "),e("code",[s._v("htop/top")]),s._v(" 命令查看 CPU 使用率，"),e("code",[s._v("idle")]),s._v(" 的cpu时间也可以直接通过 "),e("code",[s._v("top")]),s._v(" 显示出来")]),s._v(" "),e("p",[e("code",[s._v("CPU 利用率 = 1 - cpu-idle-time / cpu-time")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v("\n%Cpu"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.4")]),s._v(" us,  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.3")]),s._v(" sy,  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" ni, "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("90.1")]),s._v(" id,  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" wa,  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" hi,  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.2")]),s._v(" si,  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" st\n")])])]),e("ul",[e("li",[s._v("user: 用户态，但不包括 nice")]),s._v(" "),e("li",[s._v("system: 内核态")]),s._v(" "),e("li",[s._v("nice: 低优先级用户态，nice 值为 1-19 的 CPU 时间")]),s._v(" "),e("li",[s._v("idle (id)")]),s._v(" "),e("li",[s._v("iowait (wa)")]),s._v(" "),e("li",[s._v("irq (hi)")]),s._v(" "),e("li",[s._v("softirq (si)")]),s._v(" "),e("li",[s._v("steal (st)")])]),s._v(" "),e("h2",{attrs:{id:"系统调用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#系统调用"}},[s._v("#")]),s._v(" 系统调用")]),s._v(" "),e("p",[e("code",[s._v("strace")]),s._v(" 查看系统调用")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("-p")]),s._v(" 指定pid")]),s._v(" "),e("li",[e("code",[s._v("-c")]),s._v(" 统计各项系统调用被调用了多少次以及CPU时间")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用来看一个进程所用到的系统调用")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -p: 指定 7477 号进程")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("strace")]),s._v(" -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("7477")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用来查看某命令需要用到的系统调用")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("strace")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" index.js\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于系统调用的统计信息")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("strace")]),s._v(" -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("7477")]),s._v(" -c\n")])])]),e("h2",{attrs:{id:"内存"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#内存"}},[s._v("#")]),s._v(" 内存")]),s._v(" "),e("p",[e("code",[s._v("free")]),s._v(" 用以查看系统内存。")]),s._v(" "),e("p",[s._v("如果查看进程内存，使用 "),e("code",[s._v("pidstat -r")]),s._v(" 或者 "),e("code",[s._v("htop")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v(" -h\n              total        used        "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v("      shared  buff/cache   available\nMem:           "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".7G        682M        398M        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".1M        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".6G        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".7G\nSwap:            0B          0B          0B\n")])])]),e("h2",{attrs:{id:"页大小"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#页大小"}},[s._v("#")]),s._v(" 页大小")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ getconf -a "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" page\n")])])]),e("h2",{attrs:{id:"进程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#进程"}},[s._v("#")]),s._v(" 进程")]),s._v(" "),e("p",[s._v("衍生问题")]),s._v(" "),e("ul",[e("li",[s._v("如何根据命令名找到进程")]),s._v(" "),e("li",[s._v("如何根据参数名找到进程")]),s._v(" "),e("li",[s._v("进程状态有哪些")]),s._v(" "),e("li",[s._v("如何获取进程状态")]),s._v(" "),e("li",[s._v("如何获取进程的CPU占用率")]),s._v(" "),e("li",[s._v("如何获取进程的内存占用")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 122 PID 进程")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("122")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 根据命令名(command)找到 PID")]),s._v("\n$ pgrep -a node\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("26464")]),s._v(" node /code/node_modules/.bin/ts-node index.ts\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("30549")]),s._v(" node server.js\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 根据命令名以及参数找到 PID")]),s._v("\n$ pgrep -af ts-node\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("26464")]),s._v(" node /code/node_modules/.bin/ts-node index.ts\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 122 PID 进程的信息")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /proc/122/status\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /proc/122/*\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打印父进程树")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -s --show-parents: 显示父进程")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -a --arguments: 显示参数，如 echo hello 中 hello 为参数")]),s._v("\n$ pstree "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("122")]),s._v(" -sap\n")])])]),e("h2",{attrs:{id:"procfs"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#procfs"}},[s._v("#")]),s._v(" procfs")]),s._v(" "),e("p",[e("a",{attrs:{href:"http://man7.org/linux/man-pages/man5/proc.5.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://man7.org/linux/man-pages/man5/proc.5.html"),e("OutboundLink")],1)]),s._v(" "),e("h2",{attrs:{id:"进程的状态"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#进程的状态"}},[s._v("#")]),s._v(" 进程的状态")]),s._v(" "),e("ul",[e("li",[s._v("D    uninterruptible sleep (usually IO)")]),s._v(" "),e("li",[s._v("R    running or runnable (on run queue)")]),s._v(" "),e("li",[s._v("S    interruptible sleep (waiting for an event to complete)")]),s._v(" "),e("li",[s._v("T    stopped by job control signal")]),s._v(" "),e("li",[s._v("t    stopped by debugger during the tracing")]),s._v(" "),e("li",[s._v("W    paging (not valid since the 2.6.xx kernel)")]),s._v(" "),e("li",[s._v("X    dead (should never be seen)")]),s._v(" "),e("li",[s._v('Z    defunct ("zombie") process, terminated but not reaped by its parent')])]),s._v(" "),e("p",[s._v("使用 "),e("code",[s._v("htop/top")]),s._v(" 可以查看所有进程的状态信息，特别在几种情况下常用")]),s._v(" "),e("ul",[e("li",[s._v("查看过多的僵尸进程")]),s._v(" "),e("li",[s._v("当平均负载过大时")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 第二行可以统计所有进程的状态信息")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nTasks: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("214")]),s._v(" total,   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" running, "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("210")]),s._v(" sleeping,   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" stopped,   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" zombie\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])])]),e("h2",{attrs:{id:"进程内存"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#进程内存"}},[s._v("#")]),s._v(" 进程内存")]),s._v(" "),e("p",[e("code",[s._v("ps -O rss")]),s._v(" 指定 rss 可以查看进程的内存，另外还有命令 "),e("code",[s._v("top/htop")]),s._v(" 与 "),e("code",[s._v("pidstat -r")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 2579 PID 的内存")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -O rss 代表附加 RSS 信息进行打印")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -O rss "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2579")]),s._v("\n PID   RSS S TTY          TIME COMMAND\n "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2579")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("19876")]),s._v(" S pts/10   00:00:03 node index.js\n")])])]),e("h2",{attrs:{id:"实时查看进程内存"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#实时查看进程内存"}},[s._v("#")]),s._v(" 实时查看进程内存")]),s._v(" "),e("p",[e("code",[s._v("pidstat -sr")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 23097 PID 的内存信息，每隔一秒打印一次")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -r: 查看进程的内存信息")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -s: 查看进程的 stack 信息")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -p: 指定 PID")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1: 每间隔 1s 打印一次")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 5: 共打印 5 组")]),s._v("\n$ pidstat -sr -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("23097")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\nLinux "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.10")]),s._v(".0-693.2.2.el7.x86_64 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("shanyue"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("       07/18/19        _x86_64_        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" CPU"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":56:07      "),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("       PID  minflt/s  majflt/s     VSZ    RSS   %MEM StkSize  StkRef  Command\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":56:08        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("23097")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("366424")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("95996")]),s._v("   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.47")]),s._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("136")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("  node\n\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":56:08      "),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("       PID  minflt/s  majflt/s     VSZ    RSS   %MEM StkSize  StkRef  Command\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":56:09        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("23097")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("366424")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("95996")]),s._v("   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.47")]),s._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("136")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("  node\n\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":56:09      "),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("       PID  minflt/s  majflt/s     VSZ    RSS   %MEM StkSize  StkRef  Command\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":56:10        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("23097")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("366424")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("95996")]),s._v("   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.47")]),s._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("136")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("  node\n\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":56:10      "),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("       PID  minflt/s  majflt/s     VSZ    RSS   %MEM StkSize  StkRef  Command\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":56:11        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("23097")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("366424")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("95996")]),s._v("   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.47")]),s._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("136")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("  node\n\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":56:11      "),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("       PID  minflt/s  majflt/s     VSZ    RSS   %MEM StkSize  StkRef  Command\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":56:12        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("23097")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("366424")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("95996")]),s._v("   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.47")]),s._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("136")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("  node\n\nAverage:      "),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("       PID  minflt/s  majflt/s     VSZ    RSS   %MEM StkSize  StkRef  Command\nAverage:        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("23097")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("366424")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("95996")]),s._v("   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.47")]),s._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("136")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("  node\n")])])]),e("h2",{attrs:{id:"页表与缺页异常"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#页表与缺页异常"}},[s._v("#")]),s._v(" 页表与缺页异常")]),s._v(" "),e("p",[e("code",[s._v("pidstat -s")]),s._v(" 中 "),e("code",[s._v("minflt")]),s._v(" 与 "),e("code",[s._v("majflt")]),s._v(" 代表缺页异常")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ pidstat -s -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("23097")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\nLinux "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.10")]),s._v(".0-693.2.2.el7.x86_64 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("shanyue"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("       07/18/19        _x86_64_        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" CPU"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":56:07      "),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("       PID  minflt/s  majflt/s     VSZ    RSS   %MEM StkSize  StkRef  Command\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":56:08        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("23097")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("366424")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("95996")]),s._v("   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.47")]),s._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("136")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("  node\n\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":56:08      "),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("       PID  minflt/s  majflt/s     VSZ    RSS   %MEM StkSize  StkRef  Command\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":56:09        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("23097")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("366424")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("95996")]),s._v("   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.47")]),s._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("136")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("  node\n")])])]),e("h2",{attrs:{id:"标准输出定位到文件中"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#标准输出定位到文件中"}},[s._v("#")]),s._v(" 标准输出定位到文件中")]),s._v(" "),e("h2",{attrs:{id:"列出打开的文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#列出打开的文件"}},[s._v("#")]),s._v(" 列出打开的文件")]),s._v(" "),e("p",[e("code",[s._v("lsof")]),s._v(", list open files")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出打开的文件")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("lsof")]),s._v("\nCOMMAND     PID   TID     "),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("   FD      TYPE             DEVICE    SIZE/OFF       NODE NAME\nsystemd       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("           root  cwd       DIR              "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("253,1")]),s._v("        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v("          "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" /\nsystemd       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("           root  rtd       DIR              "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("253,1")]),s._v("        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v("          "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" /\n")])])]),e("h2",{attrs:{id:"容器中-namespace-pid-global-pid-映射"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#容器中-namespace-pid-global-pid-映射"}},[s._v("#")]),s._v(" 容器中 namespace PID -> global PID 映射")]),s._v(" "),e("p",[s._v("换一个问题就是，"),e("strong",[s._v("如何找出 docker 容器中的 pid 在宿主机对应的 pid")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器环境")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 已知容器中该进程 PID 为 122")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在容器中找到对应 PID 的信息，在 /proc/$pid/sched 中包含宿主机的信息")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /proc/122/sched\nnode "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("7477")]),s._v(", "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#threads: 7)")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])])]),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 宿主机环境")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 7477 就是对应的 global PID，在宿主机中可以找到")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -p 代表指定 PID")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -f 代表打印更多信息")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -fp "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("7477")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("        PID  "),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PPID")]),s._v("  C STIME TTY          TIME CMD\nroot      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("7477")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("7161")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" Jul10 ?        00:00:38 node index.js\n")])])]),e("h2",{attrs:{id:"global-pid-namespace-pid-映射"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#global-pid-namespace-pid-映射"}},[s._v("#")]),s._v(" global PID -> namespace PID 映射")]),s._v(" "),e("p",[s._v("换一个问题就是， "),e("strong",[s._v("已知宿主机的 PID，如何找出对应的容器")])]),s._v(" "),e("p",[e("strong",[s._v("常见的场景就是使用 "),e("code",[s._v("top/htop")]),s._v(" 定位到占用内存/CPU过高的进程，此时需要定位到它所在的容器")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通过 docker inspect 查找到对应容器")]),s._v("\n$ docker "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -q "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("xargs")]),s._v(" docker inspect --format "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{{.State.Pid}}, {{.ID}}'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("22932")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通过 cgroupfs 找到对应容器")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/22932/cgroup\n")])])]),e("p",[s._v("幸运地是有人已经在 stackoverflow 上总结出来了")]),s._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://stackoverflow.com/questions/24406743/coreos-get-docker-container-name-by-pid",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://stackoverflow.com/questions/24406743/coreos-get-docker-container-name-by-pid"),e("OutboundLink")],1)])]),s._v(" "),e("h2",{attrs:{id:"swap"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#swap"}},[s._v("#")]),s._v(" SWAP")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查找关于")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vmstat")]),s._v(" -s\n")])])]),e("h2",{attrs:{id:"inode"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#inode"}},[s._v("#")]),s._v(" inode")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -i: 打印 inode number")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -lahi\n")])])]),e("h2",{attrs:{id:"网络吞吐量"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#网络吞吐量"}},[s._v("#")]),s._v(" 网络吞吐量")]),s._v(" "),e("ul",[e("li",[s._v("带宽: 指网络链路的最大传输速率")]),s._v(" "),e("li",[s._v("吞吐量: 代表单位时间内成功传输的数据量，单位为 b/s (KB/s, MB/s)")]),s._v(" "),e("li",[s._v("PPS: pck/s (Packet Per Second)，以网络包为单位的传输速率")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看网卡信息")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ifconfig")]),s._v(" eth0\n\n$ sar -n DEV "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" eth0\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#                IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":34:37         eth0      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.00")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.00")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.69")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.90")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":34:38         eth0     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("39.00")]),s._v("     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("27.00")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.91")]),s._v("     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("38.11")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":34:39         eth0     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("13.00")]),s._v("     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("11.00")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.92")]),s._v("     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("13.97")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":34:40         eth0     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16.00")]),s._v("     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16.00")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.21")]),s._v("     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("20.86")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":34:41         eth0     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("17.00")]),s._v("     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("17.00")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.51")]),s._v("     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("15.27")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("\nAverage:         eth0     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("18.60")]),s._v("     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.60")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.45")]),s._v("     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("18.02")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("\n")])])]),e("h2",{attrs:{id:"socket-状态"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#socket-状态"}},[s._v("#")]),s._v(" socket 状态")]),s._v(" "),e("h2",{attrs:{id:"socket-信息"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#socket-信息"}},[s._v("#")]),s._v(" socket 信息")]),s._v(" "),e("p",[s._v("推荐使用 "),e("code",[s._v("ss")]),s._v("，不过 "),e("code",[s._v("netstat")]),s._v(" 仍需要掌握，在特定条件 (docker 中) 有可能没有 "),e("code",[s._v("ss")]),s._v(" 命令。")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -t TCP")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -a 所有状态")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -n 显示数字地址和端口号")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -p 显示 pid")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -tanp\nActive Internet connections "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("servers and established"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nProto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name\ntcp        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.11:35283        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      -\ntcp        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".112.2:37344     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.1:6379         ESTABLISHED "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("78")]),s._v("/node\ntcp        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" :::80                   :::*                    LISTEN      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("78")]),s._v("/node\n")])])]),e("ul",[e("li",[e("code",[s._v("Recv-Q")]),s._v(" 与 "),e("code",[s._v("Send-Q")]),s._v(" 不为0时，表示网络包堆积，需要注意")])]),s._v(" "),e("h2",{attrs:{id:"协议信息"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#协议信息"}},[s._v("#")]),s._v(" 协议信息")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 展示对每个协议的统计信息")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -s\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 展示对每个协议的统计信息")]),s._v("\n$ ss -s\nTotal: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1468")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("kernel "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1480")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nTCP:   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("613")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("estab "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("270")]),s._v(", closed "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("315")]),s._v(", orphaned "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", synrecv "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", timewait "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("41")]),s._v("/0"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", ports "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\nTransport Total     IP        IPv6\n*         "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1480")]),s._v("      -         -\nRAW       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nUDP       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\nTCP       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("298")]),s._v("       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("145")]),s._v("       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("153")]),s._v("\nINET      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("328")]),s._v("       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("167")]),s._v("       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("161")]),s._v("\nFRAG      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 也可以这样统计 estab socket 的数量")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -tanp "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" ESTAB "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("wc")]),s._v(" -l\n\n")])])]),e("h2",{attrs:{id:"tcp-连接数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#tcp-连接数"}},[s._v("#")]),s._v(" TCP 连接数")]),s._v(" "),e("h2",{attrs:{id:"postgressql-的最大连接数与当前连接数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#postgressql-的最大连接数与当前连接数"}},[s._v("#")]),s._v(" PostgresSQL 的最大连接数与当前连接数")]),s._v(" "),e("div",{staticClass:"language-sql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 最大连接数")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" max_connections"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 当前连接数")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("count")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" pg_stat_activity"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),e("h2",{attrs:{id:"mysql-的最大连接数与当前连接数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mysql-的最大连接数与当前连接数"}},[s._v("#")]),s._v(" mysql 的最大连接数与当前连接数")]),s._v(" "),e("div",{staticClass:"language-sql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 最大连接数")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" variables "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'max_connections'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 当前连接数")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("full")]),s._v(" processlist"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);