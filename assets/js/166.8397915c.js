(window.webpackJsonp=window.webpackJsonp||[]).push([[166],{612:function(t,a,s){"use strict";s.r(a);var e=s(40),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"docker-compose-简易入门"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-简易入门"}},[t._v("#")]),t._v(" docker compose 简易入门")]),t._v(" "),s("p",[t._v("当我们通过了解 "),s("a",{attrs:{href:"https://github.com/shfshanyue/op-note/blob/master/docker.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker 简易入门"),s("OutboundLink")],1),t._v(" 本篇文章后，想必此时我们已经可以基于 "),s("code",[t._v("nginx")]),t._v(" 镜像创建一个最简单的容器：启动一个最简单的 http 服务")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ docker run -d --name nginx -p "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8888")]),t._v(":80 nginx:alpine\n\n$ docker "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" -l\nCONTAINER ID        IMAGE                COMMAND                  CREATED             STATUS              PORTS                    NAMES\n404e88f0d90c        nginx:alpine         "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nginx -g \'daemon of…"')]),t._v("   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" minutes ago       Up "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" minutes        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:8888-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("/tcp     nginx\nCONTAINER ID        IMAGE                COMMAND                  CREATED             STATUS              PORTS                    NAMES\n")])])]),s("p",[t._v("其中有诸多参数命令")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("-d")]),t._v(": 启动一个 "),s("code",[t._v("daemon")]),t._v(" 进程")]),t._v(" "),s("li",[s("code",[t._v("--name")]),t._v(": 为容器指定名称")]),t._v(" "),s("li",[s("code",[t._v("-p host-port:container-port")]),t._v(": 宿主机与容器端口映射，方便容器对外提供服务")]),t._v(" "),s("li",[s("code",[t._v("nginx:alpine")]),t._v(": 基于该镜像创建容器")])]),t._v(" "),s("p",[t._v("这还只是一个简单的 "),s("code",[t._v("nginx")]),t._v(" 的容器，如果有更多的容器那应该如何管理呢？")]),t._v(" "),s("p",[s("strong",[t._v("使用 "),s("code",[t._v("docker-compose")]),t._v(" 来编排应用")])]),t._v(" "),s("ul",[s("li",[t._v("原文链接: "),s("a",{attrs:{href:"https://github.com/shfshanyue/op-note/blob/master/docker-compose.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker compose 简易入门"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("系列文章: "),s("a",{attrs:{href:"https://github.com/shfshanyue/op-note",target:"_blank",rel:"noopener noreferrer"}},[t._v("个人服务器运维指南"),s("OutboundLink")],1)])]),t._v(" "),s("h2",{attrs:{id:"快速开始"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#快速开始"}},[t._v("#")]),t._v(" 快速开始")]),t._v(" "),s("p",[t._v("使用 "),s("code",[t._v("docker-compose")]),t._v(" 创建一个最简单的容器，创建 "),s("code",[t._v("docker-compose.yaml")]),t._v(" 文件。它使用配置文件的方式代替以前传参数的方式启动容器")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3'")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nginx")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("alpine\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("service\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"8888:80"')]),t._v("\n")])])]),s("p",[t._v("使用 "),s("code",[t._v("docker-compose up")]),t._v(" 启动容器，它会自动查找当前目录下的 "),s("code",[t._v("docker-compose.yaml")]),t._v(" 文件作为配置文件")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启动")]),t._v("\n$ docker-compose up\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启动三个实例")]),t._v("\n$ docker-compose up --scale "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("nginx")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看日志，而不退出")]),t._v("\n$ docker-compose logs -f\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 停止")]),t._v("\n$ docker-compose stop\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 删除")]),t._v("\n$ docker-compose "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 在某个 Service 下的容器中执行命令")]),t._v("\n$ docker-compose "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" nginx "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sh")]),t._v("\n")])])]),s("h2",{attrs:{id:"配置文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置文件"}},[t._v("#")]),t._v(" 配置文件")]),t._v(" "),s("p",[t._v("关于 "),s("code",[t._v("compose")]),t._v(" 的所有的配置请参考官方文档 "),s("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/",target:"_blank",rel:"noopener noreferrer"}},[t._v("compose file"),s("OutboundLink")],1),t._v("，大部分配置与 "),s("code",[t._v("dockerfile")]),t._v(" 配置相类似")]),t._v(" "),s("p",[t._v("配置文件管理三种资源，"),s("code",[t._v("services")]),t._v("，"),s("code",[t._v("networks")]),t._v(" 以及 "),s("code",[t._v("volumes")]),t._v("，我们可以结合 "),s("code",[t._v("docker-compose")]),t._v(" 与 "),s("code",[t._v("traefik")]),t._v(" 来管理应用。如以下配置文件将可以以域名 "),s("code",[t._v("whiami.docker.localhost")]),t._v(" 来访问应用，详情可参考 "),s("a",{attrs:{href:"https://github.com/shfshanyue/op-note/blob/master/traefik.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("traefik 简易入门"),s("OutboundLink")],1)]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3'")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置 service")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("whoami")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" containous/whoami\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"traefik.http.routers.whoami.rule=Host(`whoami.docker.localhost`)"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置 network")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("default")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("external")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" traefik_default\n")])])]),s("h3",{attrs:{id:"image"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#image"}},[t._v("#")]),t._v(" image")]),t._v(" "),s("p",[t._v("指定镜像")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n")])])]),s("h3",{attrs:{id:"build"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#build"}},[t._v("#")]),t._v(" build")]),t._v(" "),s("p",[t._v("可以直接根据当前目录构建，而无需镜像")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("webapp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" .\n")])])]),s("h3",{attrs:{id:"ports"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ports"}},[t._v("#")]),t._v(" ports")]),t._v(" "),s("p",[t._v("主机与容器的端口映射，但是在 "),s("code",[t._v("trafik")]),t._v(" 代理下往往不需要指定")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"8080:80"')]),t._v("\n")])])]),s("h3",{attrs:{id:"labels"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#labels"}},[t._v("#")]),t._v(" labels")]),t._v(" "),s("p",[t._v("用以筛选容器，在结合 "),s("code",[t._v("traefik")]),t._v(" 或者 "),s("code",[t._v("k8s")]),t._v(" 使用时，用以控制流量")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("com.example.description")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Accounting webapp"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("com.example.department")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Finance"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("com.example.label-with-empty-value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"com.example.description=Accounting webapp"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"com.example.department=Finance"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"com.example.label-with-empty-value"')]),t._v("\n")])])]),s("h3",{attrs:{id:"container-name"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#container-name"}},[t._v("#")]),t._v(" container_name")]),t._v(" "),s("p",[t._v("指定容器名称，但是指定后不能够横向扩展，往往不会用到")]),t._v(" "),s("h2",{attrs:{id:"容器管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#容器管理"}},[t._v("#")]),t._v(" 容器管理")]),t._v(" "),s("p",[t._v("当使用 "),s("code",[t._v("docker-compose")]),t._v(" 编排应用时，同时也可以选择 "),s("code",[t._v("ctop")]),t._v(" 来管理容器。")])])}),[],!1,null,null,null);a.default=n.exports}}]);